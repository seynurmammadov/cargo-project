import * as tslib_1 from "tslib";
import { Input, Directive, forwardRef, ElementRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { APP_VALIDATORS } from "../../const/app-validators.const";
var VALIDATOR_CONFIG = "validatorConfig";
var FILE_VALIDATOR_NAMES = ["extension", "fileSize", "file"];
var FileControlDirective = /** @class */ (function () {
    function FileControlDirective(elementRef) {
        this.elementRef = elementRef;
        this.isProcessed = false;
        this.validators = [];
        this.onChange = function (_) { };
        this.onTouched = function () { };
        this.element = elementRef.nativeElement;
    }
    FileControlDirective_1 = FileControlDirective;
    FileControlDirective.prototype.onChangeCall = function (element) {
        var files = element.files;
        if (this.writeFile)
            this.onChange(files);
        else {
            if (files.length > 0)
                this.onChange(element.value);
            else
                this.onChange(undefined);
        }
    };
    FileControlDirective.prototype.writeValue = function (value) { };
    FileControlDirective.prototype.registerOnChange = function (invocation) { this.onChange = invocation; };
    FileControlDirective.prototype.registerOnTouched = function (invocation) { this.onTouched = invocation; };
    Object.defineProperty(FileControlDirective.prototype, "extension", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[0], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "fileSize", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[1], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "file", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[2], config);
        },
        enumerable: true,
        configurable: true
    });
    FileControlDirective.prototype.setConfig = function (control) {
        var _this = this;
        FILE_VALIDATOR_NAMES.forEach(function (t) {
            if (!_this[t] && control[VALIDATOR_CONFIG] && control[VALIDATOR_CONFIG][t])
                _this[t] = control[VALIDATOR_CONFIG][t];
        });
        this.isProcessed = true;
    };
    FileControlDirective.prototype.pushValidator = function (validatorName, config) {
        if (config)
            this.validators.push(APP_VALIDATORS[validatorName](config));
    };
    FileControlDirective.prototype.validate = function (control) {
        var e_1, _a;
        if (!this.isProcessed)
            this.setConfig(control);
        var result = null;
        try {
            for (var _b = tslib_1.__values(this.validators), _c = _b.next(); !_c.done; _c = _b.next()) {
                var validator = _c.value;
                result = validator(control, this.element.files);
                if (result)
                    break;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return result;
    };
    var FileControlDirective_1;
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], FileControlDirective.prototype, "writeFile", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "extension", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "fileSize", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], FileControlDirective.prototype, "file", null);
    FileControlDirective = FileControlDirective_1 = tslib_1.__decorate([
        Directive({
            selector: "input[type=file]",
            host: {
                "(change)": "onChangeCall($event.target)",
                "(blur)": "onTouched()"
            },
            providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return FileControlDirective_1; }),
                    multi: true
                }]
        }),
        tslib_1.__metadata("design:paramtypes", [ElementRef])
    ], FileControlDirective);
    return FileControlDirective;
}());
export { FileControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvIiwic291cmNlcyI6WyJkaXJlY3RpdmVzL3RlbXBsYXRlLXZhbGlkYXRpb25zL2ZpbGUtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekUsT0FBTyxFQUFtQixhQUFhLEVBQWEsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEUsSUFBTSxnQkFBZ0IsR0FBRyxpQkFBaUIsQ0FBQztBQUMzQyxJQUFNLG9CQUFvQixHQUFhLENBQUMsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztBQWF6RTtJQXVDSSw4QkFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQXBDMUMsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHckIsZUFBVSxHQUFlLEVBQUUsQ0FBQztRQUVwQyxhQUFRLEdBQUcsVUFBQyxDQUFDLElBQU8sQ0FBQyxDQUFDO1FBQ3RCLGNBQVMsR0FBRyxjQUFRLENBQUMsQ0FBQztRQStCbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBcUIsQ0FBQztJQUNwRCxDQUFDOzZCQXpDUSxvQkFBb0I7SUFXN0IsMkNBQVksR0FBWixVQUFhLE9BQXlCO1FBQ2xDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxJQUFJLENBQUMsU0FBUztZQUNkLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDcEI7WUFDRCxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQztnQkFDaEIsSUFB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eEYsT0FBTyxFQUFFLGFBQWE7b0JBQ3RCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLHNCQUFvQixFQUFwQixDQUFvQixDQUFDO29CQUNuRCxLQUFLLEVBQUUsSUFBSTtpQkFDZCxDQUFDO1NBQ0wsQ0FBQztpREF3Q2tDLFVBQVU7T0F2Q2pDLG9CQUFvQixDQW1FaEM7SUFBRCwyQkFBQztDQUFBLEFBbkVELElBbUVDO1NBbkVZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0LCBEaXJlY3RpdmUsIGZvcndhcmRSZWYsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBOR19WQUxJREFUT1JTLCBWYWxpZGF0b3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBFeHRlbnNpb25Db25maWcsIFNpemVDb25maWcsIEZpbGVDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbHMvY29uZmlnJ1xyXG5pbXBvcnQgeyBBUFBfVkFMSURBVE9SUyB9IGZyb20gXCIuLi8uLi9jb25zdC9hcHAtdmFsaWRhdG9ycy5jb25zdFwiO1xyXG5jb25zdCBWQUxJREFUT1JfQ09ORklHID0gXCJ2YWxpZGF0b3JDb25maWdcIjtcclxuY29uc3QgRklMRV9WQUxJREFUT1JfTkFNRVM6IHN0cmluZ1tdID0gW1wiZXh0ZW5zaW9uXCIsIFwiZmlsZVNpemVcIiwgXCJmaWxlXCJdO1xyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiBcImlucHV0W3R5cGU9ZmlsZV1cIixcclxuICAgIGhvc3Q6IHtcclxuICAgICAgICBcIihjaGFuZ2UpXCI6IFwib25DaGFuZ2VDYWxsKCRldmVudC50YXJnZXQpXCIsXHJcbiAgICAgICAgXCIoYmx1cilcIjogXCJvblRvdWNoZWQoKVwiXHJcbiAgICB9LFxyXG4gICAgcHJvdmlkZXJzOiBbeyBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IEZpbGVDb250cm9sRGlyZWN0aXZlLCBtdWx0aTogdHJ1ZSB9LCB7XHJcbiAgICAgICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcclxuICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGaWxlQ29udHJvbERpcmVjdGl2ZSksXHJcbiAgICAgICAgbXVsdGk6IHRydWVcclxuICAgIH1dXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGaWxlQ29udHJvbERpcmVjdGl2ZSBpbXBsZW1lbnRzIFZhbGlkYXRvciB7XHJcbiAgICBmaWxlczogYW55O1xyXG4gICAgZWxlbWVudDogYW55XHJcbiAgICBpc1Byb2Nlc3NlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgXHJcblxyXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3JzOiBGdW5jdGlvbltdID0gW107XHJcblxyXG4gICAgb25DaGFuZ2UgPSAoXykgPT4geyB9O1xyXG4gICAgb25Ub3VjaGVkID0gKCkgPT4geyB9O1xyXG5cclxuICAgIG9uQ2hhbmdlQ2FsbChlbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgbGV0IGZpbGVzID0gZWxlbWVudC5maWxlcztcclxuICAgICAgICBpZiAodGhpcy53cml0ZUZpbGUpXHJcbiAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoZmlsZXMpO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoZWxlbWVudC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UodW5kZWZpbmVkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVWYWx1ZSh2YWx1ZSkgeyB9XHJcbiAgICByZWdpc3Rlck9uQ2hhbmdlKGludm9jYXRpb246IGFueSkgeyB0aGlzLm9uQ2hhbmdlID0gaW52b2NhdGlvbjsgfVxyXG4gICAgcmVnaXN0ZXJPblRvdWNoZWQoaW52b2NhdGlvbjogYW55KSB7IHRoaXMub25Ub3VjaGVkID0gaW52b2NhdGlvbjsgfVxyXG5cclxuICAgIEBJbnB1dCgpIHdyaXRlRmlsZTogYm9vbGVhbjtcclxuICAgIEBJbnB1dCgpIHNldCBleHRlbnNpb24oY29uZmlnOiBFeHRlbnNpb25Db25maWcpIHtcclxuICAgICAgICB0aGlzLnB1c2hWYWxpZGF0b3IoRklMRV9WQUxJREFUT1JfTkFNRVNbMF0sIGNvbmZpZylcclxuICAgIH1cclxuICAgIEBJbnB1dCgpIHNldCBmaWxlU2l6ZShjb25maWc6IFNpemVDb25maWcpIHtcclxuICAgICAgICB0aGlzLnB1c2hWYWxpZGF0b3IoRklMRV9WQUxJREFUT1JfTkFNRVNbMV0sIGNvbmZpZylcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBzZXQgZmlsZShjb25maWc6IEZpbGVDb25maWcpIHtcclxuICAgICAgICB0aGlzLnB1c2hWYWxpZGF0b3IoRklMRV9WQUxJREFUT1JfTkFNRVNbMl0sIGNvbmZpZylcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgTm9kZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDb25maWcoY29udHJvbDogQWJzdHJhY3RDb250cm9sKSB7XHJcbiAgICAgICAgRklMRV9WQUxJREFUT1JfTkFNRVMuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzW3RdICYmIGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR10gJiYgY29udHJvbFtWQUxJREFUT1JfQ09ORklHXVt0XSlcclxuICAgICAgICAgICAgICAgIHRoaXNbdF0gPSBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddW3RdO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5pc1Byb2Nlc3NlZCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVzaFZhbGlkYXRvcih2YWxpZGF0b3JOYW1lOiBzdHJpbmcsIGNvbmZpZzogRXh0ZW5zaW9uQ29uZmlnIHwgU2l6ZUNvbmZpZyB8IEZpbGVDb25maWcpIHtcclxuICAgICAgICBpZiAoY29uZmlnKVxyXG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRvcnMucHVzaChBUFBfVkFMSURBVE9SU1t2YWxpZGF0b3JOYW1lXShjb25maWcpKVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0ge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1Byb2Nlc3NlZClcclxuICAgICAgICAgICAgdGhpcy5zZXRDb25maWcoY29udHJvbCk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgZm9yICh2YXIgdmFsaWRhdG9yIG9mIHRoaXMudmFsaWRhdG9ycykge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB2YWxpZGF0b3IoY29udHJvbCwgdGhpcy5lbGVtZW50LmZpbGVzKTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdClcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0XHJcbiAgICB9XHJcbn1cclxuIl19
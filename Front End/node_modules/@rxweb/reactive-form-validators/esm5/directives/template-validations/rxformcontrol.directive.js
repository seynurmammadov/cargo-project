import * as tslib_1 from "tslib";
import { Directive, Input, ElementRef, forwardRef, Renderer2 } from '@angular/core';
import { NG_VALIDATORS } from '@angular/forms';
import { APP_VALIDATORS } from '../../const/app-validators.const';
import { BaseValidator } from './base-validator.directive';
import { ELEMENT_VALUE, BLUR, FOCUS, BLANK } from "../../const";
import { TEMPLATE_VALIDATION_CONFIG, CONDITIONAL_VALIDATOR, VALIDATOR_CONFIG } from '../../const/app.const';
import { ApplicationUtil } from '../../util/app-util';
import { DecimalProvider } from "../../domain/element-processor/decimal.provider";
import { RegexValidator } from '../../util';
import { MaskProvider } from '../../domain/element-processor/mask.provider';
var NGMODEL_BINDING = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(function () { return RxFormControlDirective; }),
    multi: true
};
var ALLOW_VALIDATOR_WITHOUT_CONFIG = ['required', 'notEmpty', 'alpha', 'alphaNumeric', 'ascii', 'dataUri', 'digit', 'email', 'even', 'hexColor', 'json', 'latitude', 'latLong', 'leapYear', 'longitude', 'lowerCase', 'mac', 'odd', 'port', 'primeNumber', 'time', 'upperCase', 'url', 'unique', 'cusip', 'gird'];
var NUMERIC = "numeric";
var IS_FORMAT = "isFormat";
var DIGITS_INFO = "digitsInfo";
var RxFormControlDirective = /** @class */ (function (_super) {
    tslib_1.__extends(RxFormControlDirective, _super);
    function RxFormControlDirective(elementRef, renderer, decimalProvider) {
        var _this = _super.call(this) || this;
        _this.elementRef = elementRef;
        _this.renderer = renderer;
        _this.decimalProvider = decimalProvider;
        _this.eventListeners = [];
        _this.isNumericSubscribed = false;
        _this.isFocusCalled = false;
        _this.isMasked = false;
        _this.element = elementRef.nativeElement;
        _this.setEventName();
        return _this;
    }
    Object.defineProperty(RxFormControlDirective.prototype, "validationControls", {
        get: function () {
            return this.controls;
        },
        set: function (value) {
            this.controls = value;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControlDirective.prototype.ngOnInit = function () {
        var _this = this;
        var validators = [];
        Object.keys(APP_VALIDATORS).forEach(function (validatorName) {
            if ((_this["rx" + validatorName]) || (ALLOW_VALIDATOR_WITHOUT_CONFIG.indexOf(validatorName) != -1 && _this["rx" + validatorName] == BLANK)) {
                validators.push(APP_VALIDATORS[validatorName](_this["rx" + validatorName]));
                if (_this.name && !(_this.formControlName && _this.formControl)) {
                    ApplicationUtil.configureControl(_this.controlConfig, _this["rx" + validatorName], validatorName);
                }
            }
        });
        if (validators.length > 0)
            this.validators = validators;
        if (this.rxnumeric && (this.rxnumeric.isFormat || this.rxnumeric.digitsInfo)) {
            this.bindNumericElementEvent();
        }
    };
    RxFormControlDirective.prototype.blurEvent = function () {
        if (!(this.formControl && this.formControl.errors && this.formControl.errors.numeric)) {
            if (this.formControl.value !== null && this.formControl.value !== undefined) {
                var value = this.decimalProvider.transFormDecimal(this.formControl.value, this.rxnumeric.digitsInfo);
                value = (!this.rxnumeric.isFormat) ? this.decimalProvider.replacer(value) : value;
                this.setValueOnElement(value);
            }
            this.isFocusCalled = false;
        }
    };
    RxFormControlDirective.prototype.bindNumericElementEvent = function (config) {
        var _this = this;
        if (config)
            this.rxnumeric = config;
        var listener = this.renderer.listen(this.element, BLUR, this.blurEvent.bind(this));
        this.eventListeners.push(listener);
        listener = this.renderer.listen(this.element, FOCUS, function (event) {
            _this.isFocusCalled = true;
            if (!(_this.formControl && _this.formControl.errors && _this.formControl.errors.numeric) && _this.formControl.value != null) {
                var value = _this.decimalProvider.replacer(_this.element.value);
                _this.setValueOnElement(value);
            }
        });
        this.eventListeners.push(listener);
    };
    RxFormControlDirective.prototype.bindValueChangeEvent = function () {
        var _this = this;
        if (this.eventName != BLANK) {
            var listener = this.renderer.listen(this.element, this.eventName, function () {
                Object.keys(_this.validationControls).forEach(function (fieldName) {
                    _this.validationControls[fieldName].updateValueAndValidity();
                });
            });
            this.eventListeners.push(listener);
        }
    };
    RxFormControlDirective.prototype.subscribeNumericFormatter = function () {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG][NUMERIC] && (this.formControl[VALIDATOR_CONFIG][NUMERIC][IS_FORMAT] || this.formControl[VALIDATOR_CONFIG][NUMERIC][DIGITS_INFO])) {
            if (!this.isNumericSubscribed) {
                this.bindNumericElementEvent(this.formControl[VALIDATOR_CONFIG][NUMERIC]);
                this.isNumericSubscribed = true;
            }
            if (!this.isFocusCalled && RegexValidator.isNotBlank(this.formControl.value)) {
                this.blurEvent();
            }
        }
    };
    RxFormControlDirective.prototype.subscribeMaskValidator = function () {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG]["mask"] && !this.isMasked) {
            var config = this.formControl[VALIDATOR_CONFIG]["mask"];
            this.maskProvider = new MaskProvider(this.element, config.mask, this.renderer, this.formControl, config);
            this.isMasked = true;
        }
    };
    RxFormControlDirective.prototype.setValueOnElement = function (value) {
        this.renderer.setProperty(this.element, ELEMENT_VALUE, value);
    };
    RxFormControlDirective.prototype.setTemplateValidators = function (control) {
        for (var validatorName in control[VALIDATOR_CONFIG]) {
            this[validatorName] = control[VALIDATOR_CONFIG][validatorName];
        }
        delete control[TEMPLATE_VALIDATION_CONFIG];
        delete control[VALIDATOR_CONFIG];
        this.ngOnInit();
    };
    RxFormControlDirective.prototype.updateOnElementClass = function (element) {
        var previousClassName = '';
        return function (className) {
            if (previousClassName)
                element.classList.remove(previousClassName);
            if (className)
                element.classList.add(className);
            previousClassName = className;
        };
    };
    RxFormControlDirective.prototype.setValidatorConfig = function (control) {
        if (!this.formControl) {
            this.formControl = control;
            var rxFormControl = this.formControl;
            if (rxFormControl.updateOnElementClass)
                rxFormControl.updateOnElementClass = this.updateOnElementClass(this.element);
        }
        this.subscribeMaskValidator();
        this.subscribeNumericFormatter();
        if (control[TEMPLATE_VALIDATION_CONFIG])
            this.setTemplateValidators(control);
        if (control[CONDITIONAL_VALIDATOR]) {
            this.conditionalValidator = control[CONDITIONAL_VALIDATOR];
            delete control[CONDITIONAL_VALIDATOR];
        }
    };
    RxFormControlDirective.prototype.validate = function (control) {
        this.setValidatorConfig(control);
        if (this.conditionalValidator)
            this.conditionalValidator(control);
        if (!this.isProcessed)
            this.setModelConfig(control);
        return ((this.validators && this.validators.length > 0) || this.maskProvider) ? this.validation(control) : null;
    };
    RxFormControlDirective.prototype.ngOnDestroy = function () {
        this.controls = undefined;
        var eventCount = this.eventListeners.length;
        for (var i = 0; i < eventCount; i++) {
            this.eventListeners[0]();
            this.eventListeners.splice(0, 1);
        }
        this.eventListeners = [];
        if (this.maskProvider)
            this.maskProvider.onDestroy();
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxalpha", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxalphaNumeric", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxascii", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxcompare", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxcompose", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxcontains", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxcreditCard", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxdataUri", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxdifferent", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxdigit", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxemail", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxendsWith", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxeven", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxextension", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxfactor", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxfileSize", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxgreaterThanEqualTo", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxgreaterThan", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxhexColor", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxjson", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlatitude", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlatLong", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxleapYear", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlessThan", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlessThanEqualTo", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlongitude", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxlowerCase", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxmac", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxmaxDate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxmaxLength", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxmaxNumber", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxminDate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxminLength", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxminNumber", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxnumeric", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxodd", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxpassword", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxport", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxprimeNumber", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxrequired", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxrange", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxrule", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxstartsWith", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxtime", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxupperCase", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxurl", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxunique", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxnotEmpty", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxcusip", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxgrid", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RxFormControlDirective.prototype, "rxdate", void 0);
    RxFormControlDirective = tslib_1.__decorate([
        Directive({
            selector: '[ngModel],[formControlName],[formControl]',
            providers: [NGMODEL_BINDING],
        }),
        tslib_1.__metadata("design:paramtypes", [ElementRef,
            Renderer2, DecimalProvider])
    ], RxFormControlDirective);
    return RxFormControlDirective;
}(BaseValidator));
export { RxFormControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnhmb3JtY29udHJvbC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Acnh3ZWIvcmVhY3RpdmUtZm9ybS12YWxpZGF0b3JzLyIsInNvdXJjZXMiOlsiZGlyZWN0aXZlcy90ZW1wbGF0ZS12YWxpZGF0aW9ucy9yeGZvcm1jb250cm9sLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBcUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBYSxhQUFhLEVBQWdDLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQ0YsYUFBYSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUNyQyxNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBQUUsMEJBQTBCLEVBQUMscUJBQXFCLEVBQUMsZ0JBQWdCLEVBQUcsTUFBTSx1QkFBdUIsQ0FBQTtBQUMxRyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlEQUFpRCxDQUFBO0FBRWpGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFNUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBRzVFLElBQU0sZUFBZSxHQUFRO0lBQ3pCLE9BQU8sRUFBRSxhQUFhO0lBQ3RCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLHNCQUFzQixFQUF0QixDQUFzQixDQUFDO0lBQ3JELEtBQUssRUFBRSxJQUFJO0NBQ2QsQ0FBQztBQUVGLElBQU0sOEJBQThCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFF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cmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIE9uSW5pdCwgT25EZXN0cm95LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVmFsaWRhdG9yLCBOR19WQUxJREFUT1JTLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBBUFBfVkFMSURBVE9SUyB9IGZyb20gJy4uLy4uL2NvbnN0L2FwcC12YWxpZGF0b3JzLmNvbnN0JztcclxuaW1wb3J0IHsgQmFzZVZhbGlkYXRvciB9IGZyb20gJy4vYmFzZS12YWxpZGF0b3IuZGlyZWN0aXZlJztcclxuaW1wb3J0IHtcclxuICAgICBFTEVNRU5UX1ZBTFVFLCBCTFVSLCBGT0NVUywgQkxBTktcclxufSBmcm9tIFwiLi4vLi4vY29uc3RcIjtcclxuaW1wb3J0IHsgVEVNUExBVEVfVkFMSURBVElPTl9DT05GSUcsQ09ORElUSU9OQUxfVkFMSURBVE9SLFZBTElEQVRPUl9DT05GSUcgIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0J1xyXG5pbXBvcnQgeyBBcHBsaWNhdGlvblV0aWwgfSBmcm9tICcuLi8uLi91dGlsL2FwcC11dGlsJztcclxuaW1wb3J0IHsgRGVjaW1hbFByb3ZpZGVyIH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9lbGVtZW50LXByb2Nlc3Nvci9kZWNpbWFsLnByb3ZpZGVyXCJcclxuaW1wb3J0IHsgQWxwaGFDb25maWcsIEFycmF5Q29uZmlnLCBCYXNlQ29uZmlnLCBDaG9pY2VDb25maWcsIENvbXBhcmVDb25maWcsIENvbXBvc2VDb25maWcsIENvbnRhaW5zQ29uZmlnLCBDcmVkaXRDYXJkQ29uZmlnLCBEYXRlQ29uZmlnLCBEZWZhdWx0Q29uZmlnLCBEaWdpdENvbmZpZywgRW1haWxDb25maWcsIEV4dGVuc2lvbkNvbmZpZywgRmFjdG9yQ29uZmlnLCBNZXNzYWdlQ29uZmlnLCBOdW1iZXJDb25maWcsIE51bWVyaWNDb25maWcsIFBhc3N3b3JkQ29uZmlnLCBSYW5nZUNvbmZpZywgUmVxdWlyZWRDb25maWcsIFJ1bGVDb25maWcsIFNpemVDb25maWcsIFRpbWVDb25maWcsIERpZmZlcmVudENvbmZpZywgUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnLCBVbmlxdWVDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbHMvY29uZmlnJ1xyXG5pbXBvcnQgeyBSZWdleFZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3V0aWwnO1xyXG5pbXBvcnQgeyBSeEZvcm1Db250cm9sIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2Zvcm0tY29udHJvbFwiO1xyXG5pbXBvcnQgeyBNYXNrUHJvdmlkZXIgfSBmcm9tICcuLi8uLi9kb21haW4vZWxlbWVudC1wcm9jZXNzb3IvbWFzay5wcm92aWRlcic7XHJcblxyXG5cclxuY29uc3QgTkdNT0RFTF9CSU5ESU5HOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUnhGb3JtQ29udHJvbERpcmVjdGl2ZSksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuY29uc3QgQUxMT1dfVkFMSURBVE9SX1dJVEhPVVRfQ09ORklHID0gWydyZXF1aXJlZCcsICdub3RFbXB0eScsICdhbHBoYScsICdhbHBoYU51bWVyaWMnLCAnYXNjaWknLCAnZGF0YVVyaScsICdkaWdpdCcsICdlbWFpbCcsICdldmVuJywgJ2hleENvbG9yJywgJ2pzb24nLCAnbGF0aXR1ZGUnLCAnbGF0TG9uZycsICdsZWFwWWVhcicsICdsb25naXR1ZGUnLCAnbG93ZXJDYXNlJywgJ21hYycsICdvZGQnLCAncG9ydCcsICdwcmltZU51bWJlcicsICd0aW1lJywgJ3VwcGVyQ2FzZScsICd1cmwnLCAndW5pcXVlJywnY3VzaXAnLCdnaXJkJ107XHJcbmNvbnN0IE5VTUVSSUM6c3RyaW5nID0gXCJudW1lcmljXCI7XHJcbmNvbnN0IElTX0ZPUk1BVDpzdHJpbmcgPSBcImlzRm9ybWF0XCI7XHJcbmNvbnN0IERJR0lUU19JTkZPOiBzdHJpbmcgPSBcImRpZ2l0c0luZm9cIjtcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tuZ01vZGVsXSxbZm9ybUNvbnRyb2xOYW1lXSxbZm9ybUNvbnRyb2xdJyxcclxuICAgIHByb3ZpZGVyczogW05HTU9ERUxfQklORElOR10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSeEZvcm1Db250cm9sRGlyZWN0aXZlIGV4dGVuZHMgQmFzZVZhbGlkYXRvciBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBWYWxpZGF0b3Ige1xyXG4gICAgcHJpdmF0ZSBldmVudExpc3RlbmVyczogYW55W10gPSBbXTtcclxuICAgIHByaXZhdGUgaXNOdW1lcmljU3Vic2NyaWJlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBpc0ZvY3VzQ2FsbGVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGlzTWFza2VkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgXHJcbiAgICBzZXQgdmFsaWRhdGlvbkNvbnRyb2xzKHZhbHVlOiB7IFtrZXk6IHN0cmluZ106IEZvcm1Db250cm9sIH0pIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xzID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZhbGlkYXRpb25Db250cm9scygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9scztcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSByeGFscGhhOiBBbHBoYUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4YWxwaGFOdW1lcmljOiBBbHBoYUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4YXNjaWk6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGNvbXBhcmU6IENvbXBhcmVDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGNvbXBvc2U6IENvbXBvc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGNvbnRhaW5zOiBDb250YWluc0NvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4Y3JlZGl0Q2FyZDogQ3JlZGl0Q2FyZENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZGF0YVVyaTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZGlmZmVyZW50OiBEaWZmZXJlbnRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGRpZ2l0OiBEaWdpdENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZW1haWw6IEVtYWlsQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhlbmRzV2l0aDogRGVmYXVsdENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZXZlbjogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4ZXh0ZW5zaW9uOiBFeHRlbnNpb25Db25maWc7XHJcbiAgICBASW5wdXQoKSByeGZhY3RvcjogRmFjdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhmaWxlU2l6ZTogU2l6ZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4Z3JlYXRlclRoYW5FcXVhbFRvOiBSZWxhdGlvbmFsT3BlcmF0b3JDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGdyZWF0ZXJUaGFuOiBSZWxhdGlvbmFsT3BlcmF0b3JDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGhleENvbG9yOiBNZXNzYWdlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhqc29uOiBEZWZhdWx0Q29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhsYXRpdHVkZTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bGF0TG9uZzogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bGVhcFllYXI6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGxlc3NUaGFuOiBSZWxhdGlvbmFsT3BlcmF0b3JDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGxlc3NUaGFuRXF1YWxUbzogUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhsb25naXR1ZGU6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGxvd2VyQ2FzZTogTWVzc2FnZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bWFjOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhtYXhEYXRlOiBEYXRlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhtYXhMZW5ndGg6IE51bWJlckNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bWF4TnVtYmVyOiBOdW1iZXJDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG1pbkRhdGU6IERhdGVDb25maWc7XHJcbiAgICBASW5wdXQoKSByeG1pbkxlbmd0aDogTnVtYmVyQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhtaW5OdW1iZXI6IE51bWJlckNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4bnVtZXJpYzogTnVtZXJpY0NvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4b2RkOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhwYXNzd29yZDogUGFzc3dvcmRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHBvcnQ6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHByaW1lTnVtYmVyOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhyZXF1aXJlZDogUmVxdWlyZWRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHJhbmdlOiBSYW5nZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4cnVsZTogUnVsZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4c3RhcnRzV2l0aDogRGVmYXVsdENvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4dGltZTogVGltZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4dXBwZXJDYXNlOiBNZXNzYWdlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnh1cmw6IERlZmF1bHRDb25maWc7XHJcbiAgICBASW5wdXQoKSByeHVuaXF1ZTogVW5pcXVlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnhub3RFbXB0eTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHJ4Y3VzaXA6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGdyaWQ6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSByeGRhdGU6QmFzZUNvbmZpZztcclxuXHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZGVjaW1hbFByb3ZpZGVyOiBEZWNpbWFsUHJvdmlkZXIpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBOb2RlO1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnROYW1lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgbGV0IHZhbGlkYXRvcnMgPSBbXTtcclxuICAgICAgICBPYmplY3Qua2V5cyhBUFBfVkFMSURBVE9SUykuZm9yRWFjaCh2YWxpZGF0b3JOYW1lID0+IHtcclxuICAgICAgICAgICAgaWYgKCh0aGlzW2ByeCR7dmFsaWRhdG9yTmFtZX1gXSkgfHwgKEFMTE9XX1ZBTElEQVRPUl9XSVRIT1VUX0NPTkZJRy5pbmRleE9mKHZhbGlkYXRvck5hbWUpICE9IC0xICYmIHRoaXNbYHJ4JHt2YWxpZGF0b3JOYW1lfWBdID09IEJMQU5LKSkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9ycy5wdXNoKEFQUF9WQUxJREFUT1JTW3ZhbGlkYXRvck5hbWVdKHRoaXNbYHJ4JHt2YWxpZGF0b3JOYW1lfWBdKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lICYmICEodGhpcy5mb3JtQ29udHJvbE5hbWUgJiYgdGhpcy5mb3JtQ29udHJvbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBBcHBsaWNhdGlvblV0aWwuY29uZmlndXJlQ29udHJvbCh0aGlzLmNvbnRyb2xDb25maWcsIHRoaXNbYHJ4JHt2YWxpZGF0b3JOYW1lfWBdLCB2YWxpZGF0b3JOYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIGlmICh2YWxpZGF0b3JzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdG9ycyA9IHZhbGlkYXRvcnNcclxuICAgICAgICBpZiAodGhpcy5yeG51bWVyaWMgJiYgKHRoaXMucnhudW1lcmljLmlzRm9ybWF0IHx8IHRoaXMucnhudW1lcmljLmRpZ2l0c0luZm8pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZE51bWVyaWNFbGVtZW50RXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGJsdXJFdmVudCgpe1xyXG4gICAgICAgIGlmICghKHRoaXMuZm9ybUNvbnRyb2wgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMubnVtZXJpYykpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUgIT09IG51bGwgJiYgdGhpcy5mb3JtQ29udHJvbC52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRlY2ltYWxQcm92aWRlci50cmFuc0Zvcm1EZWNpbWFsKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUsIHRoaXMucnhudW1lcmljLmRpZ2l0c0luZm8pO1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSAoIXRoaXMucnhudW1lcmljLmlzRm9ybWF0KSA/IHRoaXMuZGVjaW1hbFByb3ZpZGVyLnJlcGxhY2VyKHZhbHVlKSA6IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pc0ZvY3VzQ2FsbGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGJpbmROdW1lcmljRWxlbWVudEV2ZW50KGNvbmZpZz86IE51bWVyaWNDb25maWcpIHtcclxuICAgICAgICBpZiAoY29uZmlnKVxyXG4gICAgICAgICAgICB0aGlzLnJ4bnVtZXJpYyA9IGNvbmZpZztcclxuICAgICAgICBsZXQgbGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQsIEJMVVIsIHRoaXMuYmx1ckV2ZW50LmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcilcclxuICAgICAgICBsaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudCwgRk9DVVMsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlzRm9jdXNDYWxsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoISh0aGlzLmZvcm1Db250cm9sICYmIHRoaXMuZm9ybUNvbnRyb2wuZXJyb3JzICYmIHRoaXMuZm9ybUNvbnRyb2wuZXJyb3JzLm51bWVyaWMpICYmIHRoaXMuZm9ybUNvbnRyb2wudmFsdWUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5kZWNpbWFsUHJvdmlkZXIucmVwbGFjZXIodGhpcy5lbGVtZW50LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVPbkVsZW1lbnQodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKVxyXG4gICAgfVxyXG5cclxuICAgIGJpbmRWYWx1ZUNoYW5nZUV2ZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmV2ZW50TmFtZSAhPSBCTEFOSykge1xyXG4gICAgICAgICAgICBsZXQgbGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnQsIHRoaXMuZXZlbnROYW1lLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnZhbGlkYXRpb25Db250cm9scykuZm9yRWFjaChmaWVsZE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGlvbkNvbnRyb2xzW2ZpZWxkTmFtZV0udXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN1YnNjcmliZU51bWVyaWNGb3JtYXR0ZXIoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybUNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR10gJiYgdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtOVU1FUklDXSAmJiAodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtOVU1FUklDXVtJU19GT1JNQVRdIHx8IHRoaXMuZm9ybUNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bTlVNRVJJQ11bRElHSVRTX0lORk9dKSkge1xyXG4gICAgICAgICAgICBpZighdGhpcy5pc051bWVyaWNTdWJzY3JpYmVkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmluZE51bWVyaWNFbGVtZW50RXZlbnQodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtOVU1FUklDXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTnVtZXJpY1N1YnNjcmliZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmlzRm9jdXNDYWxsZWQgJiYgUmVnZXhWYWxpZGF0b3IuaXNOb3RCbGFuayh0aGlzLmZvcm1Db250cm9sLnZhbHVlKSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJsdXJFdmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHN1YnNjcmliZU1hc2tWYWxpZGF0b3IoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZm9ybUNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR10gJiYgdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtcIm1hc2tcIl0gJiYgIXRoaXMuaXNNYXNrZWQpIHtcclxuICAgICAgICAgICAgbGV0IGNvbmZpZyA9IHRoaXMuZm9ybUNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bXCJtYXNrXCJdO1xyXG4gICAgICAgICAgICB0aGlzLm1hc2tQcm92aWRlciA9IG5ldyBNYXNrUHJvdmlkZXIodGhpcy5lbGVtZW50LCBjb25maWcubWFzaywgdGhpcy5yZW5kZXJlciwgdGhpcy5mb3JtQ29udHJvbCBhcyBGb3JtQ29udHJvbCwgY29uZmlnKTtcclxuICAgICAgICAgICAgdGhpcy5pc01hc2tlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0VmFsdWVPbkVsZW1lbnQodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbGVtZW50LCBFTEVNRU5UX1ZBTFVFLCB2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUZW1wbGF0ZVZhbGlkYXRvcnMoY29udHJvbDpBYnN0cmFjdENvbnRyb2wpe1xyXG4gICAgICAgIGZvcihsZXQgdmFsaWRhdG9yTmFtZSBpbiBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpc1t2YWxpZGF0b3JOYW1lXSA9IGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bdmFsaWRhdG9yTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlbGV0ZSBjb250cm9sW1RFTVBMQVRFX1ZBTElEQVRJT05fQ09ORklHXTtcclxuICAgICAgICBkZWxldGUgY29udHJvbFtWQUxJREFUT1JfQ09ORklHXVxyXG4gICAgICAgIHRoaXMubmdPbkluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZU9uRWxlbWVudENsYXNzKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgdmFyIHByZXZpb3VzQ2xhc3NOYW1lOiBzdHJpbmcgPSAnJztcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNsYXNzTmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlmIChwcmV2aW91c0NsYXNzTmFtZSlcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShwcmV2aW91c0NsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChjbGFzc05hbWUpXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKVxyXG4gICAgICAgICAgICBwcmV2aW91c0NsYXNzTmFtZSA9IGNsYXNzTmFtZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHByaXZhdGUgc2V0VmFsaWRhdG9yQ29uZmlnKGNvbnRyb2w6QWJzdHJhY3RDb250cm9sKXtcclxuICAgICAgICBpZiAoIXRoaXMuZm9ybUNvbnRyb2wpIHsgXHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSBjb250cm9sO1xyXG4gICAgICAgICAgICBsZXQgcnhGb3JtQ29udHJvbCA9IHRoaXMuZm9ybUNvbnRyb2wgYXMgUnhGb3JtQ29udHJvbDtcclxuICAgICAgICAgICAgaWYgKHJ4Rm9ybUNvbnRyb2wudXBkYXRlT25FbGVtZW50Q2xhc3MpXHJcbiAgICAgICAgICAgICAgICByeEZvcm1Db250cm9sLnVwZGF0ZU9uRWxlbWVudENsYXNzID0gdGhpcy51cGRhdGVPbkVsZW1lbnRDbGFzcyh0aGlzLmVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLnN1YnNjcmliZU1hc2tWYWxpZGF0b3IoKTtcclxuICAgICAgICB0aGlzLnN1YnNjcmliZU51bWVyaWNGb3JtYXR0ZXIoKTtcclxuICAgIGlmKGNvbnRyb2xbVEVNUExBVEVfVkFMSURBVElPTl9DT05GSUddKVxyXG4gICAgICAgIHRoaXMuc2V0VGVtcGxhdGVWYWxpZGF0b3JzKGNvbnRyb2wpO1xyXG4gICAgaWYgKGNvbnRyb2xbQ09ORElUSU9OQUxfVkFMSURBVE9SXSkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9uYWxWYWxpZGF0b3IgPSBjb250cm9sW0NPTkRJVElPTkFMX1ZBTElEQVRPUl07XHJcbiAgICAgICAgZGVsZXRlIGNvbnRyb2xbQ09ORElUSU9OQUxfVkFMSURBVE9SXTtcclxuICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICAgICAgdGhpcy5zZXRWYWxpZGF0b3JDb25maWcoY29udHJvbCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9uYWxWYWxpZGF0b3IpXHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9uYWxWYWxpZGF0b3IoY29udHJvbCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUHJvY2Vzc2VkKVxyXG4gICAgICAgICAgICB0aGlzLnNldE1vZGVsQ29uZmlnKGNvbnRyb2wpO1xyXG4gICAgICAgIHJldHVybiAoKHRoaXMudmFsaWRhdG9ycyAmJiB0aGlzLnZhbGlkYXRvcnMubGVuZ3RoID4gMCkgfHwgdGhpcy5tYXNrUHJvdmlkZXIpID8gdGhpcy52YWxpZGF0aW9uKGNvbnRyb2wpIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGxldCBldmVudENvdW50ID0gdGhpcy5ldmVudExpc3RlbmVycy5sZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudENvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVyc1swXSgpO1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnNwbGljZSgwLCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycyA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLm1hc2tQcm92aWRlcilcclxuICAgICAgICAgICAgdGhpcy5tYXNrUHJvdmlkZXIub25EZXN0cm95KCk7XHJcbiAgICB9XHJcbn1cclxuIl19
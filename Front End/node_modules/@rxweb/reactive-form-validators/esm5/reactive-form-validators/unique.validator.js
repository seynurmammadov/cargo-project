import * as tslib_1 from "tslib";
import { RegexValidator } from "../util/regex-validator";
import { ObjectMaker } from "../util/object-maker";
import { AnnotationTypes } from "../core/validator.static";
import { FormProvider } from '../util/form-provider';
import { ApplicationUtil } from '../util/app-util';
import { getConfigObject } from "../util/config-provider";
export function uniqueValidator(configModel) {
    var setTimeoutFunc = function (invalidateControls, controlValues) {
        var timeOut = setTimeout(function () {
            invalidateControls.forEach(function (t) {
                var isMatched = controlValues.filter(function (x) { return x == t.value; })[0];
                if (!isMatched)
                    t.updateValueAndValidity();
            });
            clearTimeout(timeOut);
        }, 200);
    };
    var additionalValidation = function (config, fieldName, formGroup, formArray, currentValue) {
        var indexOf = formArray.controls.indexOf(formGroup);
        var formArrayValue = [];
        if (indexOf != -1) {
            formArray.value.forEach(function (t, i) {
                if (indexOf != i)
                    formArrayValue.push(t);
            });
            return config.additionalValidation(currentValue, indexOf, fieldName, formGroup.value, formArrayValue);
        }
        return false;
    };
    return function (control) {
        var e_1, _a;
        var config = getConfigObject(configModel, control);
        if (FormProvider.ProcessRule(control, config)) {
            if (RegexValidator.isNotBlank(control.value)) {
                var formArray = ApplicationUtil.getParentFormArray(control);
                var parentFormGroup = control.parent ? control.parent : undefined;
                var invalidateControls = [];
                var controlValues = [];
                if (formArray && parentFormGroup) {
                    var currentValue = control.value;
                    var fieldName_1 = ApplicationUtil.getFormControlName(control);
                    var isMatched = false;
                    var _loop_1 = function (formGroup) {
                        if (formGroup != parentFormGroup) {
                            isMatched = (ApplicationUtil.toLower(formGroup.controls[fieldName_1].value) == ApplicationUtil.toLower(currentValue) && !(formGroup.controls[fieldName_1].errors && formGroup.controls[fieldName_1].errors[AnnotationTypes.unique]));
                            if (formGroup.controls[fieldName_1].errors && formGroup.controls[fieldName_1].errors[AnnotationTypes.unique]) {
                                matchedControl = formArray.controls.filter(function (t) { return t.controls[fieldName_1] != formGroup.controls[fieldName_1] && ApplicationUtil.toLower(t.controls[fieldName_1].value) == ApplicationUtil.toLower(formGroup.controls[fieldName_1].value); })[0];
                                if (!matchedControl)
                                    invalidateControls.push(formGroup.controls[fieldName_1]);
                            }
                            else
                                controlValues.push(formGroup.controls[fieldName_1].value);
                        }
                        if (isMatched)
                            return "break";
                    };
                    var matchedControl;
                    try {
                        for (var _b = tslib_1.__values(formArray.controls), _c = _b.next(); !_c.done; _c = _b.next()) {
                            var formGroup = _c.value;
                            var state_1 = _loop_1(formGroup);
                            if (state_1 === "break")
                                break;
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                    if (invalidateControls.length > 0)
                        setTimeoutFunc(invalidateControls, controlValues);
                    var validation = false;
                    if (config.additionalValidation) {
                        validation = additionalValidation(config, fieldName_1, parentFormGroup, formArray, currentValue);
                    }
                    if (isMatched && !validation)
                        return ObjectMaker.toJson(AnnotationTypes.unique, config, [control.value]);
                }
            }
        }
        return ObjectMaker.null();
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLnZhbGlkYXRvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvIiwic291cmNlcyI6WyJyZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvdW5pcXVlLnZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBTUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3pELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVuRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNuRCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDeEQsTUFBTSxVQUFVLGVBQWUsQ0FBQyxXQUF5QjtJQUNyRCxJQUFJLGNBQWMsR0FBRyxVQUFDLGtCQUFxQyxFQUFFLGFBQW9CO1FBQ2pGLElBQUksT0FBTyxHQUFHLFVBQVUsQ0FBQztZQUN2QixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO2dCQUMxQixJQUFJLFNBQVMsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQVosQ0FBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQzFELElBQUksQ0FBQyxTQUFTO29CQUNaLENBQUMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQy9CLENBQUMsQ0FBQyxDQUFBO1lBQ0YsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNULENBQUMsQ0FBQTtJQUNELElBQUksb0JBQW9CLEdBQUcsVUFBQyxNQUFvQixFQUFFLFNBQWlCLEVB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QyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFTLENBQUMsQ0FBQyxDQUFBOzZCQUN6RDs7Z0NBRUMsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFdBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3lCQUMzRDt3QkFDRCxJQUFJLFNBQVM7MkNBQ0w7O3dCQVJBLGNBQWM7O3dCQUp4QixLQUFzQixJQUFBLEtBQUEsaUJBQUEsU0FBUyxDQUFDLFFBQVEsQ0FBQSxnQkFBQTs0QkFBbkMsSUFBSSxTQUFTLFdBQUE7a0RBQVQsU0FBUzs7O3lCQWFqQjs7Ozs7Ozs7O29CQUNELElBQUksa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUM7d0JBQy9CLGNBQWMsQ0FBQyxrQkFBa0IsRUFBRSxhQUFhLENBQUMsQ0FBQztvQkFFcEQsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO29CQUN2QixJQUFJLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRTt3QkFDL0IsVUFBVSxHQUFHLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxXQUFTLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztxQkFDaEc7b0JBQ0QsSUFBSSxTQUFTLElBQUksQ0FBQyxVQUFVO3dCQUMxQixPQUFPLFdBQVcsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtpQkFDN0U7YUFDRjtTQUNGO1FBQ0QsT0FBTyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgVmFsaWRhdG9yRm4sXHJcbiAgQWJzdHJhY3RDb250cm9sLFxyXG4gIEZvcm1BcnJheVxyXG59IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5cclxuaW1wb3J0IHsgUmVnZXhWYWxpZGF0b3IgfSBmcm9tIFwiLi4vdXRpbC9yZWdleC12YWxpZGF0b3JcIjtcclxuaW1wb3J0IHsgT2JqZWN0TWFrZXIgfSBmcm9tIFwiLi4vdXRpbC9vYmplY3QtbWFrZXJcIjtcclxuaW1wb3J0IHsgVW5pcXVlQ29uZmlnIH0gZnJvbSBcIi4uL21vZGVscy9jb25maWcvdW5pcXVlLWNvbmZpZ1wiO1xyXG5pbXBvcnQgeyBBbm5vdGF0aW9uVHlwZXMgfSBmcm9tIFwiLi4vY29yZS92YWxpZGF0b3Iuc3RhdGljXCI7XHJcbmltcG9ydCB7IEZvcm1Qcm92aWRlciB9IGZyb20gJy4uL3V0aWwvZm9ybS1wcm92aWRlcic7XHJcbmltcG9ydCB7IEFwcGxpY2F0aW9uVXRpbCB9IGZyb20gJy4uL3V0aWwvYXBwLXV0aWwnO1xyXG5pbXBvcnQge2dldENvbmZpZ09iamVjdH0gZnJvbSBcIi4uL3V0aWwvY29uZmlnLXByb3ZpZGVyXCI7XHJcbmV4cG9ydCBmdW5jdGlvbiB1bmlxdWVWYWxpZGF0b3IoY29uZmlnTW9kZWw6IFVuaXF1ZUNvbmZpZyk6IFZhbGlkYXRvckZuIHtcclxuICAgIHZhciBzZXRUaW1lb3V0RnVuYyA9IChpbnZhbGlkYXRlQ29udHJvbHM6IEFic3RyYWN0Q29udHJvbFtdLCBjb250cm9sVmFsdWVzOiBhbnlbXSkgPT4ge1xyXG4gICAgbGV0IHRpbWVPdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaW52YWxpZGF0ZUNvbnRyb2xzLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgbGV0IGlzTWF0Y2hlZCA9IGNvbnRyb2xWYWx1ZXMuZmlsdGVyKHggPT4geCA9PSB0LnZhbHVlKVswXVxyXG4gICAgICAgIGlmICghaXNNYXRjaGVkKVxyXG4gICAgICAgICAgdC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lT3V0KTtcclxuICAgIH0sIDIwMClcclxuICB9XHJcbiAgdmFyIGFkZGl0aW9uYWxWYWxpZGF0aW9uID0gKGNvbmZpZzogVW5pcXVlQ29uZmlnLCBmaWVsZE5hbWU6IHN0cmluZywgZm9ybUdyb3VwOiBBYnN0cmFjdENvbnRyb2wsIGZvcm1BcnJheTogRm9ybUFycmF5LCBjdXJyZW50VmFsdWU6IGFueSkgPT4ge1xyXG4gICAgbGV0IGluZGV4T2YgPSBmb3JtQXJyYXkuY29udHJvbHMuaW5kZXhPZihmb3JtR3JvdXApO1xyXG4gICAgbGV0IGZvcm1BcnJheVZhbHVlID0gW107XHJcbiAgICBpZiAoaW5kZXhPZiAhPSAtMSkge1xyXG4gICAgICBmb3JtQXJyYXkudmFsdWUuZm9yRWFjaCgodCwgaSkgPT4ge1xyXG4gICAgICAgIGlmIChpbmRleE9mICE9IGkpXHJcbiAgICAgICAgICBmb3JtQXJyYXlWYWx1ZS5wdXNoKHQpXHJcbiAgICAgIH0pXHJcbiAgICAgIHJldHVybiBjb25maWcuYWRkaXRpb25hbFZhbGlkYXRpb24oY3VycmVudFZhbHVlLCBpbmRleE9mLCBmaWVsZE5hbWUsIGZvcm1Hcm91cC52YWx1ZSwgZm9ybUFycmF5VmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICB9XHJcbiAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcclxuICAgIGxldCBjb25maWcgPSBnZXRDb25maWdPYmplY3QoY29uZmlnTW9kZWwsY29udHJvbCk7XHJcbiAgICBpZiAoRm9ybVByb3ZpZGVyLlByb2Nlc3NSdWxlKGNvbnRyb2wsIGNvbmZpZykpIHtcclxuICAgICAgaWYgKFJlZ2V4VmFsaWRhdG9yLmlzTm90QmxhbmsoY29udHJvbC52YWx1ZSkpIHtcclxuICAgICAgICBsZXQgZm9ybUFycmF5ID0gQXBwbGljYXRpb25VdGlsLmdldFBhcmVudEZvcm1BcnJheShjb250cm9sKTtcclxuICAgICAgICBsZXQgcGFyZW50Rm9ybUdyb3VwID0gY29udHJvbC5wYXJlbnQgPyBjb250cm9sLnBhcmVudCA6IHVuZGVmaW5lZDtcclxuICAgICAgICBsZXQgaW52YWxpZGF0ZUNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSA9IFtdO1xyXG4gICAgICAgIGxldCBjb250cm9sVmFsdWVzID0gW107XHJcbiAgICAgICAgaWYgKGZvcm1BcnJheSAmJiBwYXJlbnRGb3JtR3JvdXApIHtcclxuICAgICAgICAgIGxldCBjdXJyZW50VmFsdWUgPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IEFwcGxpY2F0aW9uVXRpbC5nZXRGb3JtQ29udHJvbE5hbWUoY29udHJvbCk7XHJcbiAgICAgICAgICBsZXQgaXNNYXRjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICBmb3IgKGxldCBmb3JtR3JvdXAgb2YgZm9ybUFycmF5LmNvbnRyb2xzKSB7XHJcbiAgICAgICAgICAgIGlmIChmb3JtR3JvdXAgIT0gcGFyZW50Rm9ybUdyb3VwKSB7XHJcbiAgICAgICAgICAgICAgaXNNYXRjaGVkID0gKEFwcGxpY2F0aW9uVXRpbC50b0xvd2VyKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKSA9PSBBcHBsaWNhdGlvblV0aWwudG9Mb3dlcihjdXJyZW50VmFsdWUpICYmICEoZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0uZXJyb3JzICYmIGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLmVycm9yc1tBbm5vdGF0aW9uVHlwZXMudW5pcXVlXSkpXHJcbiAgICAgICAgICAgICAgaWYgKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLmVycm9ycyAmJiBmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS5lcnJvcnNbQW5ub3RhdGlvblR5cGVzLnVuaXF1ZV0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXRjaGVkQ29udHJvbCA9IGZvcm1BcnJheS5jb250cm9scy5maWx0ZXIodCA9PiB0LmNvbnRyb2xzW2ZpZWxkTmFtZV0gIT0gZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0gJiYgQXBwbGljYXRpb25VdGlsLnRvTG93ZXIodC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKSA9PSBBcHBsaWNhdGlvblV0aWwudG9Mb3dlcihmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS52YWx1ZSkpWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkQ29udHJvbClcclxuICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZUNvbnRyb2xzLnB1c2goZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWx1ZXMucHVzaChmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzTWF0Y2hlZClcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChpbnZhbGlkYXRlQ29udHJvbHMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgc2V0VGltZW91dEZ1bmMoaW52YWxpZGF0ZUNvbnRyb2xzLCBjb250cm9sVmFsdWVzKTtcclxuXHJcbiAgICAgICAgICBsZXQgdmFsaWRhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYgKGNvbmZpZy5hZGRpdGlvbmFsVmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uID0gYWRkaXRpb25hbFZhbGlkYXRpb24oY29uZmlnLCBmaWVsZE5hbWUsIHBhcmVudEZvcm1Hcm91cCwgZm9ybUFycmF5LCBjdXJyZW50VmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGlzTWF0Y2hlZCAmJiAhdmFsaWRhdGlvbilcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdE1ha2VyLnRvSnNvbihBbm5vdGF0aW9uVHlwZXMudW5pcXVlLCBjb25maWcsIFtjb250cm9sLnZhbHVlXSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBPYmplY3RNYWtlci5udWxsKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
import { ObjectMaker } from "../util/object-maker";
import { ApplicationUtil } from "../util/app-util";
import { FormProvider } from "../util/form-provider";
var DISABLED_EXPRESSION = "disableExpression";
export function conditionalChangeValidator(conditionalValidationProps) {
    var timeOuts = [];
    var oldValue = undefined;
    var setTimeOut = function (control, config) {
        if (control[DISABLED_EXPRESSION])
            runDisabledExpression(control, config);
        var timeOut = setTimeout(function (t) {
            clearTimeout(timeOut);
            control.updateValueAndValidity({ onlySelf: true });
        }, 100);
    };
    return function (control) {
        var _a;
        var value = control.value;
        if (control.parent && oldValue != value) {
            var rootFormGroup_1 = ApplicationUtil.getRootFormGroup(control);
            var parentFormGroup_1 = control.parent;
            oldValue = value;
            timeOuts = [];
            var controlName = ApplicationUtil.getFormControlName(control);
            var disabledConfig_1 = (_a = {}, _a[controlName] = value, _a);
            conditionalValidationProps.forEach(function (t) {
                var a = control;
                if (t.indexOf("[]") != -1) {
                    var splitText = t.split("[]");
                    var formArray = rootFormGroup_1.get([splitText[0]]);
                    if (formArray)
                        formArray.controls.forEach(function (formGroup) {
                            var abstractControl = formGroup.get(splitText[1]);
                            if (abstractControl) {
                                setTimeOut(abstractControl, disabledConfig_1);
                            }
                        });
                }
                else {
                    var splitText_1 = t.split('.');
                    if (splitText_1.length > 1) {
                        var control = null;
                        t.split('.').forEach(function (name, index) { control = (index == 0) ? rootFormGroup_1.controls[name] : control.controls[name]; });
                    }
                    else {
                        control = parentFormGroup_1.controls[t];
                    }
                    if (control) {
                        setTimeOut(control, disabledConfig_1);
                    }
                }
            });
        }
        return ObjectMaker.null();
    };
}
function runDisabledExpression(control, config) {
    var isDisabled = FormProvider.ProcessRule(control, { conditionalExpression: control[DISABLED_EXPRESSION], disableConfig: config });
    if (isDisabled && !control.disabled)
        control.disable();
    else if (control.disabled)
        control.enable();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uYWwtY2hhbmdlLnZhbGlkYXRvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvIiwic291cmNlcyI6WyJyZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvY29uZGl0aW9uYWwtY2hhbmdlLnZhbGlkYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFPQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQUNwRCxJQUFNLG1CQUFtQixHQUFXLG1CQUFtQixDQUFDO0FBQ3hELE1BQU0sVUFBVSwwQkFBMEIsQ0FBQywwQkFBb0M7SUFDM0UsSUFBSSxRQUFRLEdBQWEsRUFBRSxDQUFDO0lBQzVCLElBQUksUUFBUSxHQUFXLFNBQVMsQ0FBQztJQUNqQyxJQUFJLFVBQVUsR0FBRyxVQUFDLE9BQXdCLEVBQUUsTUFBVztRQUNuRCxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztZQUM1QixxQkFBcUIsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDM0MsSUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFDLFVBQUEsQ0FBQztZQUN0QixZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEIsT0FBTyxDQUFDLHNCQUFzQixDQUFDLEVBQUUsUUFBUSxFQUFDLElBQUksRUFBRSxDQUFDLENBQUE7UUFDckQsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ1gsQ0FBQyxDQUFBO0lBQ0QsT0FBTyxVQUFDLE9BQXdCOztRQUM1QixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQzFCLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxRQUFRLElBQUksS0FBSyxFQUFFO1lBQ3JDLElBQU0sZUFBYSxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoRSxJQUFNLGlCQUFlLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUN2QyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQ2pCLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDZCxJQUFJLFdBQVcsR0FBRyxlQUFlLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDOUQsSUFBSSxnQkFBYyxhQUFLLEdBQUMsV0FBVyxJQUFHLEtBQUssS0FBRSxDQUFDO1lBQzlDLDBCQUEwQixDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztnQkFDaEIsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO29CQUN2QixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUM5QixJQUFJLFNBQVMsR0FBYyxlQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDN0QsSUFBSSxTQUFTO3dCQUNULFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsU0FBUzs0QkFDaEMsSUFBSSxlQUFlLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDbEQsSUFBSSxlQUFlLEVBQUU7Z0NBQ2pCLFVBQVUsQ0FBQyxlQUFlLEVBQUUsZ0JBQWMsQ0FBQyxDQUFDOzZCQUMvQzt3QkFDTCxDQUFDLENBQUMsQ0FBQTtpQkFDVDtxQkFBTTtvQkFFSCxJQUFJLFdBQVMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUM3QixJQUFJLFdBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO3dCQUN0QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7d0JBQ25CLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSSxFQUFFLEtBQUssSUFBTyxPQUFPLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtxQkFDN0g7eUJBQ0k7d0JBQ0QsT0FBTyxHQUFHLGlCQUFlLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUN6QztvQkFFRCxJQUFJLE9BQU8sRUFBRTt3QkFFVCxVQUFVLENBQUMsT0FBTyxFQUFFLGdCQUFjLENBQUMsQ0FBQztxQkFDdkM7aUJBQ0o7WUFDTCxDQUFDLENBQUMsQ0FBQTtTQUNMO1FBQ0QsT0FBTyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDOUIsQ0FBQyxDQUFBO0FBQ0wsQ0FBQztBQUNELFNBQVMscUJBQXFCLENBQUMsT0FBTyxFQUFFLE1BQU07SUFDMUMsSUFBSSxVQUFVLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsRUFBRSxxQkFBcUIsRUFBRSxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFBRSxhQUFhLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNuSSxJQUFJLFVBQVUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRO1FBQy9CLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNqQixJQUFJLE9BQU8sQ0FBQyxRQUFRO1FBQ3JCLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUN6QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIFZhbGlkYXRvckZuLFxyXG4gICAgQWJzdHJhY3RDb250cm9sLFxyXG5cclxuICAgIEZvcm1BcnJheVxyXG59IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5cclxuaW1wb3J0IHsgT2JqZWN0TWFrZXIgfSBmcm9tIFwiLi4vdXRpbC9vYmplY3QtbWFrZXJcIjtcclxuaW1wb3J0IHsgQXBwbGljYXRpb25VdGlsIH0gZnJvbSBcIi4uL3V0aWwvYXBwLXV0aWxcIlxyXG5pbXBvcnQgeyBGb3JtUHJvdmlkZXIgfSBmcm9tIFwiLi4vdXRpbC9mb3JtLXByb3ZpZGVyXCJcclxuY29uc3QgRElTQUJMRURfRVhQUkVTU0lPTjogc3RyaW5nID0gXCJkaXNhYmxlRXhwcmVzc2lvblwiO1xyXG5leHBvcnQgZnVuY3Rpb24gY29uZGl0aW9uYWxDaGFuZ2VWYWxpZGF0b3IoY29uZGl0aW9uYWxWYWxpZGF0aW9uUHJvcHM6IHN0cmluZ1tdKTogVmFsaWRhdG9yRm4ge1xyXG4gICAgdmFyIHRpbWVPdXRzOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgdmFyIG9sZFZhbHVlOiBzdHJpbmcgPSB1bmRlZmluZWQ7XHJcbiAgICB2YXIgc2V0VGltZU91dCA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIGNvbmZpZzogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGNvbnRyb2xbRElTQUJMRURfRVhQUkVTU0lPTl0pXHJcbiAgICAgICAgICAgIHJ1bkRpc2FibGVkRXhwcmVzc2lvbihjb250cm9sLCBjb25maWcpO1xyXG4gICAgICAgIHZhciB0aW1lT3V0ID0gc2V0VGltZW91dCh0ID0+IHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVPdXQpO1xyXG4gICAgICAgICAgICBjb250cm9sLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoeyBvbmx5U2VsZjp0cnVlIH0pXHJcbiAgICAgICAgfSwgMTAwKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0+IHtcclxuICAgICAgICBsZXQgdmFsdWUgPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgIGlmIChjb250cm9sLnBhcmVudCAmJiBvbGRWYWx1ZSAhPSB2YWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCByb290Rm9ybUdyb3VwID0gQXBwbGljYXRpb25VdGlsLmdldFJvb3RGb3JtR3JvdXAoY29udHJvbCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudEZvcm1Hcm91cCA9IGNvbnRyb2wucGFyZW50O1xyXG4gICAgICAgICAgICBvbGRWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB0aW1lT3V0cyA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgY29udHJvbE5hbWUgPSBBcHBsaWNhdGlvblV0aWwuZ2V0Rm9ybUNvbnRyb2xOYW1lKGNvbnRyb2wpO1xyXG4gICAgICAgICAgICBsZXQgZGlzYWJsZWRDb25maWcgPSB7IFtjb250cm9sTmFtZV06IHZhbHVlIH07XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbmFsVmFsaWRhdGlvblByb3BzLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYSA9IGNvbnRyb2w7XHJcbiAgICAgICAgICAgICAgICBpZiAodC5pbmRleE9mKFwiW11cIikgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3BsaXRUZXh0ID0gdC5zcGxpdChcIltdXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JtQXJyYXkgPSA8Rm9ybUFycmF5PnJvb3RGb3JtR3JvdXAuZ2V0KFtzcGxpdFRleHRbMF1dKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybUFycmF5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtQXJyYXkuY29udHJvbHMuZm9yRWFjaChmb3JtR3JvdXAgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFic3RyYWN0Q29udHJvbCA9IGZvcm1Hcm91cC5nZXQoc3BsaXRUZXh0WzFdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYnN0cmFjdENvbnRyb2wpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lT3V0KGFic3RyYWN0Q29udHJvbCwgZGlzYWJsZWRDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNwbGl0VGV4dCA9IHQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRUZXh0Lmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRyb2wgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNwbGl0KCcuJykuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHsgY29udHJvbCA9IChpbmRleCA9PSAwKSA/IHJvb3RGb3JtR3JvdXAuY29udHJvbHNbbmFtZV0gOiBjb250cm9sLmNvbnRyb2xzW25hbWVdOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbCA9IHBhcmVudEZvcm1Hcm91cC5jb250cm9sc1t0XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250cm9sKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lT3V0KGNvbnRyb2wsIGRpc2FibGVkQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBPYmplY3RNYWtlci5udWxsKCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcnVuRGlzYWJsZWRFeHByZXNzaW9uKGNvbnRyb2wsIGNvbmZpZykge1xyXG4gICAgbGV0IGlzRGlzYWJsZWQgPSBGb3JtUHJvdmlkZXIuUHJvY2Vzc1J1bGUoY29udHJvbCwgeyBjb25kaXRpb25hbEV4cHJlc3Npb246IGNvbnRyb2xbRElTQUJMRURfRVhQUkVTU0lPTl0sIGRpc2FibGVDb25maWc6IGNvbmZpZyB9KTtcclxuICAgIGlmIChpc0Rpc2FibGVkICYmICFjb250cm9sLmRpc2FibGVkKVxyXG4gICAgICAgIGNvbnRyb2wuZGlzYWJsZSgpO1xyXG4gICAgZWxzZSBpZiAoY29udHJvbC5kaXNhYmxlZClcclxuICAgICAgICBjb250cm9sLmVuYWJsZSgpO1xyXG59XHJcbiJdfQ==
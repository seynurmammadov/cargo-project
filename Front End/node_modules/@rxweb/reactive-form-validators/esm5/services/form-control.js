import * as tslib_1 from "tslib";
import { FormControl } from "@angular/forms";
import { ObjectMaker } from "../util/object-maker";
import { MESSAGE, CONTROLS_ERROR, VALUE_CHANGED_SYNC } from '../const';
import { ApplicationUtil } from '../util/app-util';
import { DisableProvider } from '../domain/disable-provider';
import { RXCODE, MODEL_INSTANCE, PATCH } from "../const/app.const";
import { DECORATORS } from "../const/decorators.const";
import { defaultContainer } from "../core/defaultContainer";
import { SANITIZERS } from "../util/sanitizers";
import { ErrorMessageBindingStrategy } from "../enums";
import { ReactiveFormConfig } from "../util/reactive-form-config";
var DIRTY = "dirty";
var TOUCHED = "touched";
var UNTOUCHED = "untouched";
var PRISTINE = "pristine";
var PENDING = "pending";
var RxFormControl = /** @class */ (function (_super) {
    tslib_1.__extends(RxFormControl, _super);
    function RxFormControl(formState, validator, asyncValidator, entityObject, baseObject, controlName, _sanitizers) {
        var _this = _super.call(this, formState, validator, asyncValidator) || this;
        _this.entityObject = entityObject;
        _this.baseObject = baseObject;
        _this._sanitizers = _sanitizers;
        _this._errorMessages = [];
        _this._childColumns = [];
        _this._refDisableControls = [];
        _this._refMessageControls = [];
        _this._refClassNameControls = [];
        _this._isPassedExpression = false;
        _this._dirty = false;
        _this.backEndErrors = {};
        _this._baseValue = formState === undefined ? null : _this.getFormState(formState);
        _this._isModified = false;
        _this.keyName = controlName;
        _this._validators = validator.validators;
        _this._asyncValidators = validator.asyncValidators;
        _this._errorMessageBindingStrategy = ReactiveFormConfig.get("reactiveForm.errorMessageBindingStrategy");
        if (_this._sanitizers) {
            var floatSanitizer = _this._sanitizers.filter(function (t) { return t.name == "toFloat"; })[0];
            if (floatSanitizer && _this._baseValue && ReactiveFormConfig.number && ReactiveFormConfig.number.decimalSymbol == ",") {
                var baseValue = String(_this._baseValue);
                if (baseValue.indexOf('.') != -1) {
                    _this._baseValue = baseValue.replace(".", ReactiveFormConfig.number.decimalSymbol);
                    _super.prototype.setValue.call(_this, _this._baseValue);
                }
            }
        }
        return _this;
    }
    Object.defineProperty(RxFormControl.prototype, "errors", {
        get: function () {
            if (this._language && this._language != this.getLanguage() && this.validator) {
                this.errors = this.validator(this);
            }
            return this._errors;
        },
        set: function (value) {
            this._errors = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessages", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessages.length == 0 && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return [];
            if (!this.errors && this._errorMessages.length > 0)
                this.setControlErrorMessages();
            if (this._language != this.getLanguage())
                this.setControlErrorMessages();
            return this._errorMessages;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessage", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessage == undefined && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return undefined;
            if (!this.errors && this._errorMessage)
                this.setControlErrorMessages();
            if (this._language != this.getLanguage())
                this.setControlErrorMessages();
            return this._errorMessage;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.getFormState = function (value) {
        var baseValue = value;
        if (Array.isArray(value)) {
            baseValue = [];
            value.forEach(function (t) { return baseValue.push(t); });
        }
        return baseValue;
    };
    Object.defineProperty(RxFormControl.prototype, "isModified", {
        get: function () {
            return this._isModified;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.getValidators = function () {
        return this.getValidatorSource(this._validators);
    };
    RxFormControl.prototype.getAsyncValidators = function () {
        return this.getValidatorSource(this._asyncValidators);
    };
    RxFormControl.prototype.getValidatorSource = function (validators) {
        if (validators)
            return Array.isArray(validators) ? tslib_1.__spread(validators) : [validators];
        return [];
    };
    RxFormControl.prototype.setValidators = function (newValidator) {
        this._validators = newValidator;
        _super.prototype.setValidators.call(this, newValidator);
    };
    RxFormControl.prototype.setAsyncValidators = function (newValidator) {
        this._asyncValidators = newValidator;
        _super.prototype.setAsyncValidators.call(this, newValidator);
    };
    RxFormControl.prototype.setValue = function (value, options) {
        this.parent.changing = true;
        var parsedValue = this.getSanitizedValue(value);
        if (options && options.dirty)
            this.baseObject[this.keyName] = value;
        this.entityObject[this.keyName] = parsedValue;
        _super.prototype.setValue.call(this, value, options);
        this.bindError();
        this.bindClassName();
        this.executeExpressions();
        this.callPatch();
        if (options && !options.updateChanged && this.root[VALUE_CHANGED_SYNC]) {
            this.root[VALUE_CHANGED_SYNC]();
        }
        this.parent.changing = false;
    };
    RxFormControl.prototype.getControlValue = function () {
        return this.getSanitizedValue(this.value);
    };
    RxFormControl.prototype.bindError = function () {
        if (this._messageExpression)
            this._isPassedExpression = this.executeExpression(this._messageExpression, this);
        this.setControlErrorMessages();
        this.errors = this.errors;
    };
    RxFormControl.prototype.bindClassName = function () {
        if (this.updateOnElementClass && typeof this.updateOnElementClass === "function") {
            var className = this.executeExpression(this._classNameExpression, this);
            var updateElement = this.updateOnElementClass;
            updateElement(className);
        }
    };
    RxFormControl.prototype.setBackEndErrors = function (error) {
        var _this = this;
        Object.keys(error).forEach(function (key) { return _this.backEndErrors[key] = error[key]; });
        this.setControlErrorMessages();
    };
    RxFormControl.prototype.clearBackEndErrors = function (errors) {
        var _this = this;
        if (!errors)
            this.backEndErrors = {};
        else
            Object.keys(errors).forEach(function (t) { return delete _this.backEndErrors[t]; });
        this.setControlErrorMessages();
    };
    RxFormControl.prototype.markAsTouched = function (opts) {
        var currentState = this.touched;
        _super.prototype.markAsTouched.call(this, opts);
        if (currentState != this.touched)
            this.runControlPropChangeExpression([TOUCHED, UNTOUCHED]);
    };
    RxFormControl.prototype.markAsUntouched = function (opts) {
        var currentState = this.untouched;
        _super.prototype.markAsUntouched.call(this, opts);
        if (currentState != this.untouched)
            this.runControlPropChangeExpression([UNTOUCHED, TOUCHED]);
    };
    RxFormControl.prototype.markAsDirty = function (opts) {
        var currentState = this._dirty;
        _super.prototype.markAsDirty.call(this, opts);
        this._dirty = true;
        if (currentState != this._dirty)
            this.runControlPropChangeExpression([DIRTY]);
    };
    RxFormControl.prototype.markAsPristine = function (opts) {
        var currentState = this.pristine;
        _super.prototype.markAsDirty.call(this, opts);
        if (currentState != this.pristine)
            this.runControlPropChangeExpression([PRISTINE]);
    };
    RxFormControl.prototype.markAsPending = function (opts) {
        var currentState = this.pending;
        _super.prototype.markAsDirty.call(this, opts);
        if (currentState != this.pending)
            this.runControlPropChangeExpression([PENDING]);
    };
    RxFormControl.prototype.runControlPropChangeExpression = function (propNames) {
        var _this = this;
        propNames.forEach(function (name) {
            if ((_this._controlProp && _this._messageExpression && _this._controlProp[name]) || (!_this._messageExpression && _this.checkErrorMessageStrategy()))
                _this.bindError();
            if (_this._classNameControlProp && _this._classNameControlProp[name])
                _this.bindClassName();
        });
    };
    RxFormControl.prototype.refresh = function () {
        this.getMessageExpression(this.parent, this.keyName);
        this.bindConditionalControls(DECORATORS.disabled, "_refDisableControls");
        this.bindConditionalControls(DECORATORS.error, "_refMessageControls");
        this.bindConditionalControls(DECORATORS.elementClass, "_refClassNameControls");
        this.executeExpressions();
        this.bindError();
    };
    RxFormControl.prototype.reset = function (value) {
        if (value !== undefined)
            this.setValue(value);
        else
            this.setValue(this.getFormState(this._baseValue));
        this._dirty = false;
    };
    RxFormControl.prototype.commit = function () {
        this._baseValue = this.value;
        this.callPatch();
    };
    RxFormControl.prototype.callPatch = function () {
        this._isModified = this.getValue(this._baseValue) != this.getValue(this.value);
        if (this.parent && this.parent[PATCH])
            this.parent[PATCH](this.keyName);
    };
    RxFormControl.prototype.checkErrorMessageStrategy = function () {
        var isBind = true;
        switch (this._errorMessageBindingStrategy) {
            case ErrorMessageBindingStrategy.OnSubmit:
                isBind = this.parent.submitted;
                break;
            case ErrorMessageBindingStrategy.OnDirty:
                isBind = this._dirty;
                break;
            case ErrorMessageBindingStrategy.OnTouched:
                isBind = this.touched;
                break;
            case ErrorMessageBindingStrategy.OnDirtyOrTouched:
                isBind = this._dirty || this.touched;
                break;
            case ErrorMessageBindingStrategy.OnDirtyOrSubmit:
                isBind = this._dirty || this.parent.submitted;
                break;
            case ErrorMessageBindingStrategy.OnTouchedOrSubmit:
                isBind = this.touched || this.parent.submitted;
                break;
            default:
                isBind = true;
        }
        return isBind;
    };
    RxFormControl.prototype.executeExpressions = function () {
        this.processExpression("_refDisableControls", "disabled");
        this.processExpression("_refMessageControls", "bindError");
        this.processExpression("_refClassNameControls", "bindClassName");
    };
    RxFormControl.prototype.getMessageExpression = function (formGroup, keyName) {
        if (formGroup[MODEL_INSTANCE]) {
            var instanceContainer = defaultContainer.get(formGroup[MODEL_INSTANCE].constructor);
            if (instanceContainer) {
                this._messageExpression = instanceContainer.nonValidationDecorators.error.conditionalExpressions[keyName];
                this._controlProp = instanceContainer.nonValidationDecorators.error.controlProp[this.keyName];
                this._classNameExpression = instanceContainer.nonValidationDecorators.elementClass.conditionalExpressions[keyName];
                this._classNameControlProp = instanceContainer.nonValidationDecorators.elementClass.controlProp[keyName];
                if (this._classNameExpression)
                    this.updateOnElementClass = true;
            }
        }
    };
    RxFormControl.prototype.getSanitizedValue = function (value) {
        var e_1, _a;
        if (this._sanitizers) {
            try {
                for (var _b = tslib_1.__values(this._sanitizers), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var sanitizer = _c.value;
                    value = SANITIZERS[sanitizer.name](value, sanitizer.config);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return value;
    };
    RxFormControl.prototype.bindConditionalControls = function (decoratorType, refName) {
        var _this = this;
        this._disableProvider = new DisableProvider(decoratorType, this.entityObject);
        this[refName] = this._disableProvider.zeroArgumentProcess(this, this.keyName);
        this._disableProvider.oneArgumentProcess(this, "" + this.keyName + RXCODE + "1").forEach(function (t) { return _this[refName].push(t); });
    };
    RxFormControl.prototype.setControlErrorMessages = function () {
        var _this = this;
        if ((!this._messageExpression && this.checkErrorMessageStrategy()) || this._isPassedExpression) {
            this._errorMessages = [];
            if (this.errors) {
                Object.keys(this.errors).forEach(function (t) {
                    if (_this.parent) {
                        _this.parent[CONTROLS_ERROR][_this.keyName] = _this._errorMessage = _this.getErrorMessage(_this.errors, t);
                        if (!_this._errorMessage) {
                            var errorObject = ObjectMaker.toJson(t, undefined, [_this.errors[t][t]]);
                            _this.parent[CONTROLS_ERROR][_this.keyName] = _this._errorMessage = _this.getErrorMessage(errorObject, t);
                        }
                    }
                    else
                        _this._errorMessage = _this.getErrorMessage(_this.errors, t);
                    _this._errorMessages.push(_this._errorMessage);
                });
            }
            else {
                this._errorMessage = undefined;
                if (this.parent) {
                    this.parent[CONTROLS_ERROR][this.keyName] = undefined;
                    delete this.parent[CONTROLS_ERROR][this.keyName];
                }
            }
            var backEndErrors = Object.keys(this.backEndErrors);
            if (backEndErrors.length > 0)
                backEndErrors.forEach(function (t) { _this._errorMessages.push(_this._errorMessage = _this.backEndErrors[t]); });
        }
        else {
            this._errorMessages = [];
            this._errorMessage = undefined;
        }
        this._language = this.getLanguage();
    };
    RxFormControl.prototype.getLanguage = function () {
        return (ReactiveFormConfig.i18n && ReactiveFormConfig.i18n.language) ? ReactiveFormConfig.i18n.language : undefined;
    };
    RxFormControl.prototype.getErrorMessage = function (errorObject, keyName) {
        if (errorObject[keyName][MESSAGE])
            return errorObject[keyName][MESSAGE];
        return;
    };
    RxFormControl.prototype.processExpression = function (propName, operationType) {
        var e_2, _a;
        if (this[propName])
            try {
                for (var _b = tslib_1.__values(this[propName]), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var controlInfo = _c.value;
                    var control = controlInfo.isRoot ? ApplicationUtil.getControl(controlInfo.controlPath, ApplicationUtil.getRootFormGroup(this)) : ApplicationUtil.getFormControl(controlInfo.controlPath, this);
                    if (control) {
                        if (operationType == "disabled") {
                            var result = this.executeExpression(controlInfo.conditionalExpression, control);
                            if (result)
                                control.disable();
                            else
                                control.enable();
                        }
                        else if (operationType == "bindError")
                            control.bindError();
                        else if (operationType == "bindClassName")
                            control.bindClassName();
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
    };
    RxFormControl.prototype.executeExpression = function (expression, control) {
        return expression.call(control.parent[MODEL_INSTANCE], control, ApplicationUtil.getParentModelInstanceValue(this), control.parent[MODEL_INSTANCE]);
    };
    RxFormControl.prototype.getValue = function (value) {
        return value !== undefined && value !== null && value !== "" ? value : "";
    };
    return RxFormControl;
}(FormControl));
export { RxFormControl };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb250cm9sLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL2Zvcm0tY29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUE4QixXQUFXLEVBQXlELE1BQU0sZ0JBQWdCLENBQUM7QUFDaEksT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDbEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzVELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUUvQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDdkQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFbEUsSUFBTSxLQUFLLEdBQVcsT0FBTyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFXLFNBQVMsQ0FBQztBQUNsQyxJQUFNLFNBQVMsR0FBVyxXQUFXLENBQUM7QUFDdEMsSUFBTSxRQUFRLEdBQVcsVUFBVSxDQUFDO0FBQ3BDLElBQU0sT0FBTyxHQUFXLFNBQVMsQ0FBQztBQUVsQztJQUFtQyx5Q0FBVztJQXNFMUMsdUJBQVksU0FBYyxFQUFFLFNBQXNFLEVBQUUsY0FBNEQsRUFBVSxZQUFvQyxFQUFV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Q0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFBO0lBQ3RKLENBQUM7SUFFTyxnQ0FBUSxHQUFoQixVQUFpQixLQUFVO1FBQ3ZCLE9BQU8sS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQzlFLENBQUM7SUFFTCxvQkFBQztBQUFELENBQUMsQUF2WkQsQ0FBbUMsV0FBVyxHQXVaN0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtR3JvdXAsIEFic3RyYWN0Q29udHJvbCwgRm9ybUNvbnRyb2wsIFZhbGlkYXRvckZuLCBBc3luY1ZhbGlkYXRvckZuLCBBYnN0cmFjdENvbnRyb2xPcHRpb25zIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XHJcbmltcG9ydCB7IE9iamVjdE1ha2VyIH0gZnJvbSBcIi4uL3V0aWwvb2JqZWN0LW1ha2VyXCI7XHJcbmltcG9ydCB7IE1FU1NBR0UsIENPTlRST0xTX0VSUk9SLCBWQUxVRV9DSEFOR0VEX1NZTkMgfSBmcm9tICcuLi9jb25zdCdcclxuaW1wb3J0IHsgQXBwbGljYXRpb25VdGlsIH0gZnJvbSAnLi4vdXRpbC9hcHAtdXRpbCdcclxuaW1wb3J0IHsgRGlzYWJsZVByb3ZpZGVyIH0gZnJvbSAnLi4vZG9tYWluL2Rpc2FibGUtcHJvdmlkZXInO1xyXG5pbXBvcnQgeyBSWENPREUsIE1PREVMX0lOU1RBTkNFLCBQQVRDSCB9IGZyb20gXCIuLi9jb25zdC9hcHAuY29uc3RcIlxyXG5pbXBvcnQgeyBERUNPUkFUT1JTIH0gZnJvbSBcIi4uL2NvbnN0L2RlY29yYXRvcnMuY29uc3RcIjtcclxuaW1wb3J0IHsgZGVmYXVsdENvbnRhaW5lciB9IGZyb20gXCIuLi9jb3JlL2RlZmF1bHRDb250YWluZXJcIjtcclxuaW1wb3J0IHsgU0FOSVRJWkVSUyB9IGZyb20gXCIuLi91dGlsL3Nhbml0aXplcnNcIlxyXG5pbXBvcnQgeyBEYXRhU2FuaXRpemVyIH0gZnJvbSAnLi4vY29yZS92YWxpZGF0b3IuaW50ZXJmYWNlJ1xyXG5pbXBvcnQgeyBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kgfSBmcm9tIFwiLi4vZW51bXNcIjtcclxuaW1wb3J0IHsgUmVhY3RpdmVGb3JtQ29uZmlnIH0gZnJvbSBcIi4uL3V0aWwvcmVhY3RpdmUtZm9ybS1jb25maWdcIjtcclxuXHJcbmNvbnN0IERJUlRZOiBzdHJpbmcgPSBcImRpcnR5XCI7XHJcbmNvbnN0IFRPVUNIRUQ6IHN0cmluZyA9IFwidG91Y2hlZFwiO1xyXG5jb25zdCBVTlRPVUNIRUQ6IHN0cmluZyA9IFwidW50b3VjaGVkXCI7XHJcbmNvbnN0IFBSSVNUSU5FOiBzdHJpbmcgPSBcInByaXN0aW5lXCI7XHJcbmNvbnN0IFBFTkRJTkc6IHN0cmluZyA9IFwicGVuZGluZ1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFJ4Rm9ybUNvbnRyb2wgZXh0ZW5kcyBGb3JtQ29udHJvbCB7XHJcbiAgICBwcml2YXRlIF9sYW5ndWFnZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBrZXlOYW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9lcnJvck1lc3NhZ2U6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Vycm9yTWVzc2FnZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9kaXNhYmxlUHJvdmlkZXI6IERpc2FibGVQcm92aWRlcjtcclxuICAgIHByaXZhdGUgX2NvbHVtbnM6IHN0cmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBfY2hpbGRDb2x1bW5zOiBhbnkgPSBbXTtcclxuICAgIHByaXZhdGUgX3BhcmVudENvbHVtbnM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nW10gfTtcclxuICAgIHByaXZhdGUgX3JlZkRpc2FibGVDb250cm9scyA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfcmVmTWVzc2FnZUNvbnRyb2xzID0gW107XHJcbiAgICBwcml2YXRlIF9yZWZDbGFzc05hbWVDb250cm9scyA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5OiBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3k7XHJcbiAgICBwcml2YXRlIF9tZXNzYWdlRXhwcmVzc2lvbjogRnVuY3Rpb247XHJcbiAgICBwcml2YXRlIF9jbGFzc05hbWVFeHByZXNzaW9uOiBGdW5jdGlvbjtcclxuICAgIHByaXZhdGUgX2lzUGFzc2VkRXhwcmVzc2lvbjogQm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBfY29udHJvbFByb3A6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgcHJpdmF0ZSBfY2xhc3NOYW1lQ29udHJvbFByb3A6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgcHJpdmF0ZSBfYmFzZVZhbHVlOiBhbnk7XHJcbiAgICBwcml2YXRlIF9pc01vZGlmaWVkOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfZXJyb3JzOiBhbnk7XHJcbiAgICBwcml2YXRlIF9kaXJ0eTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBfdmFsaWRhdG9yczogVmFsaWRhdG9yRm5bXSA7XHJcbiAgICBwcml2YXRlIF9hc3luY1ZhbGlkYXRvcnM6IEFzeW5jVmFsaWRhdG9yRm5bXSA7XHJcblxyXG5cclxuICAgIGJhY2tFbmRFcnJvcnM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcclxuICAgIHVwZGF0ZU9uRWxlbWVudENsYXNzOiBib29sZWFuIHwgRnVuY3Rpb247XHJcbiAgICBwcmVIb29rOiBGdW5jdGlvbjtcclxuICAgIHBvc3RIb29rOiBGdW5jdGlvbjtcclxuXHJcbiAgICBnZXQgZXJyb3JzKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9sYW5ndWFnZSAmJiB0aGlzLl9sYW5ndWFnZSAhPSB0aGlzLmdldExhbmd1YWdlKCkgJiYgdGhpcy52YWxpZGF0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvcnMgPSB0aGlzLnZhbGlkYXRvcih0aGlzKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBlcnJvcnModmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2Vycm9ycyA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXQgZXJyb3JNZXNzYWdlcygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZXJyb3JNZXNzYWdlcy5sZW5ndGggPT0gMCAmJiB0aGlzLmVycm9ycylcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgIXRoaXMuX2lzUGFzc2VkRXhwcmVzc2lvbilcclxuICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgIGlmICghdGhpcy5lcnJvcnMgJiYgdGhpcy5fZXJyb3JNZXNzYWdlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX2xhbmd1YWdlICE9IHRoaXMuZ2V0TGFuZ3VhZ2UoKSlcclxuICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lcnJvck1lc3NhZ2VzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBlcnJvck1lc3NhZ2UoKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAoIXRoaXMuX21lc3NhZ2VFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9lcnJvck1lc3NhZ2UgPT0gdW5kZWZpbmVkICYmIHRoaXMuZXJyb3JzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiAmJiAhdGhpcy5faXNQYXNzZWRFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICghdGhpcy5lcnJvcnMgJiYgdGhpcy5fZXJyb3JNZXNzYWdlKVxyXG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX2xhbmd1YWdlICE9IHRoaXMuZ2V0TGFuZ3VhZ2UoKSlcclxuICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lcnJvck1lc3NhZ2U7XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3Rvcihmb3JtU3RhdGU6IGFueSwgdmFsaWRhdG9yOiBWYWxpZGF0b3JGbiB8IEFic3RyYWN0Q29udHJvbE9wdGlvbnMgfCBWYWxpZGF0b3JGbltdIHwgbnVsbCwgYXN5bmNWYWxpZGF0b3I6IEFzeW5jVmFsaWRhdG9yRm4gfCBBc3luY1ZhbGlkYXRvckZuW10gfCBudWxsLCBwcml2YXRlIGVudGl0eU9iamVjdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgcHJpdmF0ZSBiYXNlT2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBjb250cm9sTmFtZTogc3RyaW5nLCBwcml2YXRlIF9zYW5pdGl6ZXJzOiBEYXRhU2FuaXRpemVyW10pIHtcclxuICAgICAgICBzdXBlcihmb3JtU3RhdGUsIHZhbGlkYXRvciwgYXN5bmNWYWxpZGF0b3IpXHJcbiAgICAgICAgdGhpcy5fYmFzZVZhbHVlID0gZm9ybVN0YXRlID09PSB1bmRlZmluZWQgPyBudWxsIDogdGhpcy5nZXRGb3JtU3RhdGUoZm9ybVN0YXRlKTtcclxuICAgICAgICB0aGlzLl9pc01vZGlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5rZXlOYW1lID0gY29udHJvbE5hbWU7XHJcbiAgICAgICAgdGhpcy5fdmFsaWRhdG9ycyA9ICh2YWxpZGF0b3IgYXMgQWJzdHJhY3RDb250cm9sT3B0aW9ucykudmFsaWRhdG9ycyBhcyBWYWxpZGF0b3JGbltdO1xyXG4gICAgICAgIHRoaXMuX2FzeW5jVmFsaWRhdG9ycyA9ICh2YWxpZGF0b3IgYXMgQWJzdHJhY3RDb250cm9sT3B0aW9ucykuYXN5bmNWYWxpZGF0b3JzIGFzIEFzeW5jVmFsaWRhdG9yRm5bXTtcclxuICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kgPSBSZWFjdGl2ZUZvcm1Db25maWcuZ2V0KFwicmVhY3RpdmVGb3JtLmVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneVwiKSBhcyBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3k7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Nhbml0aXplcnMpIHtcclxuICAgICAgICAgICAgdmFyIGZsb2F0U2FuaXRpemVyID0gdGhpcy5fc2FuaXRpemVycy5maWx0ZXIodCA9PiB0Lm5hbWUgPT0gXCJ0b0Zsb2F0XCIpWzBdXHJcbiAgICAgICAgICAgIGlmIChmbG9hdFNhbml0aXplciAmJiB0aGlzLl9iYXNlVmFsdWUgJiYgUmVhY3RpdmVGb3JtQ29uZmlnLm51bWJlciAmJiBSZWFjdGl2ZUZvcm1Db25maWcubnVtYmVyLmRlY2ltYWxTeW1ib2wgPT0gXCIsXCIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBiYXNlVmFsdWUgPSBTdHJpbmcodGhpcy5fYmFzZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVmFsdWUuaW5kZXhPZignLicpICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmFzZVZhbHVlID0gYmFzZVZhbHVlLnJlcGxhY2UoXCIuXCIsIFJlYWN0aXZlRm9ybUNvbmZpZy5udW1iZXIuZGVjaW1hbFN5bWJvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VwZXIuc2V0VmFsdWUodGhpcy5fYmFzZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGb3JtU3RhdGUodmFsdWUpIHtcclxuICAgICAgICBsZXQgYmFzZVZhbHVlID0gdmFsdWVcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgYmFzZVZhbHVlID0gW107XHJcbiAgICAgICAgICAgIHZhbHVlLmZvckVhY2godCA9PiBiYXNlVmFsdWUucHVzaCh0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiYXNlVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzTW9kaWZpZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTW9kaWZpZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWxpZGF0b3JTb3VyY2UodGhpcy5fdmFsaWRhdG9ycyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QXN5bmNWYWxpZGF0b3JzKCk6IEFzeW5jVmFsaWRhdG9yRm5bXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsaWRhdG9yU291cmNlKHRoaXMuX2FzeW5jVmFsaWRhdG9ycyk7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFZhbGlkYXRvclNvdXJjZSh2YWxpZGF0b3JzOmFueVtdKSB7XHJcbiAgICAgICAgaWYgKHZhbGlkYXRvcnMpXHJcbiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbGlkYXRvcnMpID8gWy4uLnZhbGlkYXRvcnNdIDogW3ZhbGlkYXRvcnNdXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFZhbGlkYXRvcnMobmV3VmFsaWRhdG9yOiBWYWxpZGF0b3JGbiB8IFZhbGlkYXRvckZuW10gfCBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5fdmFsaWRhdG9ycyA9IG5ld1ZhbGlkYXRvciBhcyBWYWxpZGF0b3JGbltdO1xyXG4gICAgICAgIHN1cGVyLnNldFZhbGlkYXRvcnMobmV3VmFsaWRhdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRBc3luY1ZhbGlkYXRvcnMobmV3VmFsaWRhdG9yOiBBc3luY1ZhbGlkYXRvckZuIHwgQXN5bmNWYWxpZGF0b3JGbltdIHwgbnVsbCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX2FzeW5jVmFsaWRhdG9ycyA9IG5ld1ZhbGlkYXRvciBhcyBBc3luY1ZhbGlkYXRvckZuW107XHJcbiAgICAgICAgc3VwZXIuc2V0QXN5bmNWYWxpZGF0b3JzKG5ld1ZhbGlkYXRvcik7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWUodmFsdWU6IGFueSwgb3B0aW9ucz86IHtcclxuICAgICAgICBkaXJ0eT86IGJvb2xlYW47XHJcbiAgICAgICAgdXBkYXRlQ2hhbmdlZD86IGJvb2xlYW47XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgICAgIGVtaXRFdmVudD86IGJvb2xlYW47XHJcbiAgICAgICAgaXNUaHJvdWdoRHluYW1pYz86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgKDxhbnk+dGhpcy5wYXJlbnQpLmNoYW5naW5nID0gdHJ1ZTtcclxuICAgICAgICBsZXQgcGFyc2VkVmFsdWUgPSB0aGlzLmdldFNhbml0aXplZFZhbHVlKHZhbHVlKVxyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZGlydHkpXHJcbiAgICAgICAgICAgIHRoaXMuYmFzZU9iamVjdFt0aGlzLmtleU5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5lbnRpdHlPYmplY3RbdGhpcy5rZXlOYW1lXSA9IHBhcnNlZFZhbHVlO1xyXG4gICAgICAgIHN1cGVyLnNldFZhbHVlKHZhbHVlLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgdGhpcy5iaW5kRXJyb3IoKTtcclxuICAgICAgICB0aGlzLmJpbmRDbGFzc05hbWUoKTtcclxuICAgICAgICB0aGlzLmV4ZWN1dGVFeHByZXNzaW9ucygpO1xyXG4gICAgICAgIHRoaXMuY2FsbFBhdGNoKCk7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgIW9wdGlvbnMudXBkYXRlQ2hhbmdlZCAmJiB0aGlzLnJvb3RbVkFMVUVfQ0hBTkdFRF9TWU5DXSkge1xyXG4gICAgICAgICAgICB0aGlzLnJvb3RbVkFMVUVfQ0hBTkdFRF9TWU5DXSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAoPGFueT50aGlzLnBhcmVudCkuY2hhbmdpbmcgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb250cm9sVmFsdWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2FuaXRpemVkVmFsdWUodGhpcy52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmluZEVycm9yKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbilcclxuICAgICAgICAgICAgdGhpcy5faXNQYXNzZWRFeHByZXNzaW9uID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbih0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnM7XHJcbiAgICB9XHJcblxyXG4gICAgYmluZENsYXNzTmFtZSgpIHtcclxuICAgICAgICBpZiAodGhpcy51cGRhdGVPbkVsZW1lbnRDbGFzcyAmJiB0eXBlb2YgdGhpcy51cGRhdGVPbkVsZW1lbnRDbGFzcyA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgIGxldCBjbGFzc05hbWUgPSB0aGlzLmV4ZWN1dGVFeHByZXNzaW9uKHRoaXMuX2NsYXNzTmFtZUV4cHJlc3Npb24sIHRoaXMpO1xyXG4gICAgICAgICAgICBsZXQgdXBkYXRlRWxlbWVudCA9IHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgYXMgRnVuY3Rpb247XHJcbiAgICAgICAgICAgIHVwZGF0ZUVsZW1lbnQoY2xhc3NOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNldEJhY2tFbmRFcnJvcnMoZXJyb3I6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhlcnJvcikuZm9yRWFjaChrZXkgPT4gdGhpcy5iYWNrRW5kRXJyb3JzW2tleV0gPSBlcnJvcltrZXldKTtcclxuICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJCYWNrRW5kRXJyb3JzKGVycm9ycz86IHsgW2tleTogc3RyaW5nXTogYW55IH0pIHtcclxuICAgICAgICBpZiAoIWVycm9ycylcclxuICAgICAgICAgICAgdGhpcy5iYWNrRW5kRXJyb3JzID0ge307XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZvckVhY2godCA9PiBkZWxldGUgdGhpcy5iYWNrRW5kRXJyb3JzW3RdKTtcclxuICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzVG91Y2hlZChvcHRzPzoge1xyXG4gICAgICAgIG9ubHlTZWxmPzogYm9vbGVhbjtcclxuICAgIH0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gdGhpcy50b3VjaGVkO1xyXG4gICAgICAgIHN1cGVyLm1hcmtBc1RvdWNoZWQob3B0cyk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLnRvdWNoZWQpXHJcbiAgICAgICAgICAgIHRoaXMucnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKFtUT1VDSEVELCBVTlRPVUNIRURdKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNVbnRvdWNoZWQob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMudW50b3VjaGVkO1xyXG4gICAgICAgIHN1cGVyLm1hcmtBc1VudG91Y2hlZChvcHRzKTtcclxuICAgICAgICBpZiAoY3VycmVudFN0YXRlICE9IHRoaXMudW50b3VjaGVkKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbVU5UT1VDSEVELCBUT1VDSEVEXSlcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNEaXJ0eShvcHRzPzoge1xyXG4gICAgICAgIG9ubHlTZWxmPzogYm9vbGVhbjtcclxuICAgIH0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gdGhpcy5fZGlydHk7XHJcbiAgICAgICAgc3VwZXIubWFya0FzRGlydHkob3B0cyk7XHJcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xyXG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUgIT0gdGhpcy5fZGlydHkpXHJcbiAgICAgICAgICAgIHRoaXMucnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKFtESVJUWV0pXHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzUHJpc3RpbmUob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMucHJpc3RpbmU7XHJcbiAgICAgICAgc3VwZXIubWFya0FzRGlydHkob3B0cyk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLnByaXN0aW5lKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbUFJJU1RJTkVdKVxyXG4gICAgfVxyXG5cclxuICAgIG1hcmtBc1BlbmRpbmcob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICAgICAgZW1pdEV2ZW50PzogYm9vbGVhbjtcclxuICAgIH0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gdGhpcy5wZW5kaW5nO1xyXG4gICAgICAgIHN1cGVyLm1hcmtBc0RpcnR5KG9wdHMpO1xyXG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUgIT0gdGhpcy5wZW5kaW5nKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbUEVORElOR10pXHJcbiAgICB9XHJcblxyXG4gICAgcnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKHByb3BOYW1lczogc3RyaW5nW10pIHtcclxuICAgICAgICBwcm9wTmFtZXMuZm9yRWFjaChuYW1lID0+IHtcclxuICAgICAgICAgICAgaWYgKCh0aGlzLl9jb250cm9sUHJvcCAmJiB0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiAmJiB0aGlzLl9jb250cm9sUHJvcFtuYW1lXSkgfHwgKCF0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiAmJiB0aGlzLmNoZWNrRXJyb3JNZXNzYWdlU3RyYXRlZ3koKSkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRFcnJvcigpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fY2xhc3NOYW1lQ29udHJvbFByb3AgJiYgdGhpcy5fY2xhc3NOYW1lQ29udHJvbFByb3BbbmFtZV0pXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRDbGFzc05hbWUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMuZ2V0TWVzc2FnZUV4cHJlc3Npb24oPEZvcm1Hcm91cD50aGlzLnBhcmVudCwgdGhpcy5rZXlOYW1lKTtcclxuICAgICAgICB0aGlzLmJpbmRDb25kaXRpb25hbENvbnRyb2xzKERFQ09SQVRPUlMuZGlzYWJsZWQsIFwiX3JlZkRpc2FibGVDb250cm9sc1wiKTtcclxuICAgICAgICB0aGlzLmJpbmRDb25kaXRpb25hbENvbnRyb2xzKERFQ09SQVRPUlMuZXJyb3IsIFwiX3JlZk1lc3NhZ2VDb250cm9sc1wiKTtcclxuICAgICAgICB0aGlzLmJpbmRDb25kaXRpb25hbENvbnRyb2xzKERFQ09SQVRPUlMuZWxlbWVudENsYXNzLCBcIl9yZWZDbGFzc05hbWVDb250cm9sc1wiKTtcclxuICAgICAgICB0aGlzLmV4ZWN1dGVFeHByZXNzaW9ucygpO1xyXG4gICAgICAgIHRoaXMuYmluZEVycm9yKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXQodmFsdWU/OiBhbnkpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHRoaXMuZ2V0Rm9ybVN0YXRlKHRoaXMuX2Jhc2VWYWx1ZSkpO1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWl0KCkge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5jYWxsUGF0Y2goKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGxQYXRjaCgpIHtcclxuICAgICAgICB0aGlzLl9pc01vZGlmaWVkID0gdGhpcy5nZXRWYWx1ZSh0aGlzLl9iYXNlVmFsdWUpICE9IHRoaXMuZ2V0VmFsdWUodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50W1BBVENIXSlcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnRbUEFUQ0hdKHRoaXMua2V5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkge1xyXG4gICAgICAgIGxldCBpc0JpbmQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgIGNhc2UgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5Lk9uU3VibWl0OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gKDxhbnk+dGhpcy5wYXJlbnQpLnN1Ym1pdHRlZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PbkRpcnR5OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gdGhpcy5fZGlydHk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kuT25Ub3VjaGVkOlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gdGhpcy50b3VjaGVkO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5Lk9uRGlydHlPclRvdWNoZWQ6XHJcbiAgICAgICAgICAgICAgICBpc0JpbmQgPSB0aGlzLl9kaXJ0eSB8fCB0aGlzLnRvdWNoZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kuT25EaXJ0eU9yU3VibWl0OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gdGhpcy5fZGlydHkgfHwgKDxhbnk+dGhpcy5wYXJlbnQpLnN1Ym1pdHRlZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PblRvdWNoZWRPclN1Ym1pdDpcclxuICAgICAgICAgICAgICAgIGlzQmluZCA9IHRoaXMudG91Y2hlZCB8fCAoPGFueT50aGlzLnBhcmVudCkuc3VibWl0dGVkO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpc0JpbmQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNCaW5kO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZXhlY3V0ZUV4cHJlc3Npb25zKCkge1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc0V4cHJlc3Npb24oXCJfcmVmRGlzYWJsZUNvbnRyb2xzXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZNZXNzYWdlQ29udHJvbHNcIiwgXCJiaW5kRXJyb3JcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZDbGFzc05hbWVDb250cm9sc1wiLCBcImJpbmRDbGFzc05hbWVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNZXNzYWdlRXhwcmVzc2lvbihmb3JtR3JvdXA6IEZvcm1Hcm91cCwga2V5TmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGZvcm1Hcm91cFtNT0RFTF9JTlNUQU5DRV0pIHtcclxuICAgICAgICAgICAgbGV0IGluc3RhbmNlQ29udGFpbmVyID0gZGVmYXVsdENvbnRhaW5lci5nZXQoZm9ybUdyb3VwW01PREVMX0lOU1RBTkNFXS5jb25zdHJ1Y3Rvcik7XHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZUNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gPSBpbnN0YW5jZUNvbnRhaW5lci5ub25WYWxpZGF0aW9uRGVjb3JhdG9ycy5lcnJvci5jb25kaXRpb25hbEV4cHJlc3Npb25zW2tleU5hbWVdXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jb250cm9sUHJvcCA9IGluc3RhbmNlQ29udGFpbmVyLm5vblZhbGlkYXRpb25EZWNvcmF0b3JzLmVycm9yLmNvbnRyb2xQcm9wW3RoaXMua2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uID0gaW5zdGFuY2VDb250YWluZXIubm9uVmFsaWRhdGlvbkRlY29yYXRvcnMuZWxlbWVudENsYXNzLmNvbmRpdGlvbmFsRXhwcmVzc2lvbnNba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGFzc05hbWVDb250cm9sUHJvcCA9IGluc3RhbmNlQ29udGFpbmVyLm5vblZhbGlkYXRpb25EZWNvcmF0b3JzLmVsZW1lbnRDbGFzcy5jb250cm9sUHJvcFtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFNhbml0aXplZFZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBzYW5pdGl6ZXIgb2YgdGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBTQU5JVElaRVJTW3Nhbml0aXplci5uYW1lXSh2YWx1ZSwgc2FuaXRpemVyLmNvbmZpZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZENvbmRpdGlvbmFsQ29udHJvbHMoZGVjb3JhdG9yVHlwZTogc3RyaW5nLCByZWZOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9kaXNhYmxlUHJvdmlkZXIgPSBuZXcgRGlzYWJsZVByb3ZpZGVyKGRlY29yYXRvclR5cGUsIHRoaXMuZW50aXR5T2JqZWN0KTtcclxuICAgICAgICB0aGlzW3JlZk5hbWVdID0gdGhpcy5fZGlzYWJsZVByb3ZpZGVyLnplcm9Bcmd1bWVudFByb2Nlc3ModGhpcywgdGhpcy5rZXlOYW1lKVxyXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQcm92aWRlci5vbmVBcmd1bWVudFByb2Nlc3ModGhpcywgYCR7dGhpcy5rZXlOYW1lfSR7UlhDT0RFfTFgKS5mb3JFYWNoKHQgPT4gdGhpc1tyZWZOYW1lXS5wdXNoKHQpKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCkge1xyXG4gICAgICAgIGlmICgoIXRoaXMuX21lc3NhZ2VFeHByZXNzaW9uICYmIHRoaXMuY2hlY2tFcnJvck1lc3NhZ2VTdHJhdGVneSgpKSB8fCB0aGlzLl9pc1Bhc3NlZEV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lcnJvcnMpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuZXJyb3JzKS5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFtDT05UUk9MU19FUlJPUl1bdGhpcy5rZXlOYW1lXSA9IHRoaXMuX2Vycm9yTWVzc2FnZSA9IHRoaXMuZ2V0RXJyb3JNZXNzYWdlKHRoaXMuZXJyb3JzLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9lcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlcnJvck9iamVjdCA9IE9iamVjdE1ha2VyLnRvSnNvbih0LCB1bmRlZmluZWQsIFt0aGlzLmVycm9yc1t0XVt0XV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV0gPSB0aGlzLl9lcnJvck1lc3NhZ2UgPSB0aGlzLmdldEVycm9yTWVzc2FnZShlcnJvck9iamVjdCwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gdGhpcy5nZXRFcnJvck1lc3NhZ2UodGhpcy5lcnJvcnMsIHQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlcy5wdXNoKHRoaXMuX2Vycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV0gPSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGJhY2tFbmRFcnJvcnMgPSBPYmplY3Qua2V5cyh0aGlzLmJhY2tFbmRFcnJvcnMpO1xyXG4gICAgICAgICAgICBpZiAoYmFja0VuZEVycm9ycy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgYmFja0VuZEVycm9ycy5mb3JFYWNoKHQgPT4geyB0aGlzLl9lcnJvck1lc3NhZ2VzLnB1c2godGhpcy5fZXJyb3JNZXNzYWdlID0gdGhpcy5iYWNrRW5kRXJyb3JzW3RdKTsgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX2Vycm9yTWVzc2FnZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbGFuZ3VhZ2UgPSB0aGlzLmdldExhbmd1YWdlKCk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRMYW5ndWFnZSgpIHtcclxuICAgICAgICByZXR1cm4gKFJlYWN0aXZlRm9ybUNvbmZpZy5pMThuICYmIFJlYWN0aXZlRm9ybUNvbmZpZy5pMThuLmxhbmd1YWdlKSA/IFJlYWN0aXZlRm9ybUNvbmZpZy5pMThuLmxhbmd1YWdlIDogdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RXJyb3JNZXNzYWdlKGVycm9yT2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBrZXlOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoZXJyb3JPYmplY3Rba2V5TmFtZV1bTUVTU0FHRV0pXHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvck9iamVjdFtrZXlOYW1lXVtNRVNTQUdFXTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIHByb2Nlc3NFeHByZXNzaW9uKHByb3BOYW1lOiBzdHJpbmcsIG9wZXJhdGlvblR5cGU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzW3Byb3BOYW1lXSlcclxuICAgICAgICAgICAgZm9yICh2YXIgY29udHJvbEluZm8gb2YgdGhpc1twcm9wTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgIGxldCBjb250cm9sID0gY29udHJvbEluZm8uaXNSb290ID8gQXBwbGljYXRpb25VdGlsLmdldENvbnRyb2woY29udHJvbEluZm8uY29udHJvbFBhdGgsIEFwcGxpY2F0aW9uVXRpbC5nZXRSb290Rm9ybUdyb3VwKHRoaXMpKSA6IEFwcGxpY2F0aW9uVXRpbC5nZXRGb3JtQ29udHJvbChjb250cm9sSW5mby5jb250cm9sUGF0aCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb25UeXBlID09IFwiZGlzYWJsZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbihjb250cm9sSW5mby5jb25kaXRpb25hbEV4cHJlc3Npb24sIGNvbnRyb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5kaXNhYmxlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5lbmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvblR5cGUgPT0gXCJiaW5kRXJyb3JcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5iaW5kRXJyb3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvcGVyYXRpb25UeXBlID09IFwiYmluZENsYXNzTmFtZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sLmJpbmRDbGFzc05hbWUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGV4ZWN1dGVFeHByZXNzaW9uKGV4cHJlc3Npb246IEZ1bmN0aW9uLCBjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBCb29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbi5jYWxsKGNvbnRyb2wucGFyZW50W01PREVMX0lOU1RBTkNFXSwgY29udHJvbCwgQXBwbGljYXRpb25VdGlsLmdldFBhcmVudE1vZGVsSW5zdGFuY2VWYWx1ZSh0aGlzKSwgY29udHJvbC5wYXJlbnRbTU9ERUxfSU5TVEFOQ0VdKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSBcIlwiID8gdmFsdWUgOiBcIlwiO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=